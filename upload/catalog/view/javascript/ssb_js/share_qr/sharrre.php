<?php header('content-type: application/json');$json=array('url'=>'','count'=>0);$json['url']=$_GET['url'];$url=urlencode($_GET['url']);$type=urlencode($_GET['type']);if(filter_var($_GET['url'],FILTER_VALIDATE_URL)){ if($type=='googlePlus'){ $content=parse("https://plusone.google.com/u/0/_/+1/fastbutton?url=".$url."&count=true");$dom=new DOMDocument;$dom->preserveWhiteSpace=false;@$dom->loadHTML($content);$domxpath=new DOMXPath($dom);$newDom=new DOMDocument;$newDom->formatOutput=true;$filtered=$domxpath->query("//div[@id='aggregateCount']");if (isset($filtered->item(0)->nodeValue)) { $json['count']=str_replace('>','',$filtered->item(0)->nodeValue);} } else if($type=='stumbleupon'){ $content=parse("http://www.stumbleupon.com/services/1.01/badge.getinfo?url=$url");$result=json_decode($content);if (isset($result->result->views)) { $json['count']=$result->result->views;} } } echo str_replace('\\/','/',json_encode($json));function parse($encUrl){ $options=array( CURLOPT_RETURNTRANSFER=> true,CURLOPT_HEADER=> false,CURLOPT_FOLLOWLOCATION=> true,CURLOPT_ENCODING=> "",CURLOPT_USERAGENT=> 'sharrre',CURLOPT_AUTOREFERER=> true,CURLOPT_CONNECTTIMEOUT=> 5,CURLOPT_TIMEOUT=> 10,CURLOPT_MAXREDIRS=> 3,CURLOPT_SSL_VERIFYHOST=> 0,CURLOPT_SSL_VERIFYPEER=> false,);$ch=curl_init();$options[CURLOPT_URL]=$encUrl;curl_setopt_array($ch,$options);$content=curl_exec($ch);$err=curl_errno($ch);$errmsg=curl_error($ch);curl_close($ch);if ($errmsg !='' || $err !='') { } return $content;}
