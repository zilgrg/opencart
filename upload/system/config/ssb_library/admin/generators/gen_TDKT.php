<?php class gen_TDKT extends Controller { private $ssb_data;private $gen_helper;private $def_data=array( 'entity_cat' => '','entity_name'=> '','CPBI' => 'all','id_entity' => '','testgenerator'=> false,'additionData'=> '','pack' => 0 );function __construct(){ global $registry;parent::__construct($registry);require_once DIR_CONFIG.'ssb_library/ssb_data.php';$this->ssb_data=ssb_data::getInstance();require_once DIR_CONFIG.'ssb_library/admin/generators/gen_helper.php';$this->gen_helper=gen_helper::getInstance();} static private $Instance =NULL;static public function getInstance() { if(self::$Instance==NULL){ $class=__CLASS__;self::$Instance=new $class;} return self::$Instance;} public function generate($data){ $time_start=microtime(true);extract(array_merge($this->def_data,$data));$res_count=0;$res_seo_data=array();if($entity_name=='all'){ $meta_Entites=$this->ssb_data->getMatadata('Entites');foreach($meta_Entites[$entity_cat] as $entity_name=> $val){ $this->setVars_CPBI_urls($entity_cat,$entity_name,$testgenerator,$additionData);$this->doGenerate($id_entity,$pack);$res_count +=$this->g_count;$res_seo_data=array_merge($res_seo_data,$this->seo_data);} }else{ $this->setVars_CPBI_urls($entity_cat,$entity_name,$testgenerator,$additionData);$this->doGenerate($id_entity,$pack);$res_count =$this->g_count;$res_seo_data =$this->seo_data;} $time_end=microtime(true);$time=$time_end-$time_start;return array('time'=> $time,'count'=> $res_count,'seo_data'=> $res_seo_data);} public function doGenerate($id_entity='',$pack=0){ $setting=$this->ssb_data->getSetting();$templates['data'] =$setting['entity'][$this->entity_cat][$this->entity_name]['data'];if($this->entity_name=='product' AND $this->entity_cat !='descrip'){ require_once DIR_CONFIG.'ssb_library/ssb_category_template.php';$ssb_category_template=ssb_category_template::getInstance();$category_template=$ssb_category_template->getCategoryTemplate(array('category_entity'=> $this->entity_cat),true);if($category_template){ $templates['category_data']=$category_template;foreach($templates['category_data'] as $item_id=> $cat_templates){ $templ_objs['category_data'][$item_id]=$this->gen_helper->parseTemplate($this->entity_cat,$this->entity_name,$cat_templates);} } } if($this->entity_cat=='descrip' AND $this->entity_name=='product'){ $templates['category_data']=$setting['entity'][$this->entity_cat][$this->entity_name]['category_data'];foreach($templates['category_data'] as $item_id=> $cat_templates){ $templ_objs['category_data'][$item_id]=$this->gen_helper->parseTemplate($this->entity_cat,$this->entity_name,$cat_templates);} } $templ_objs['data']=$this->gen_helper->parseTemplate($this->entity_cat,$this->entity_name,$templates['data']);$respond =$this->gen_helper->setSeoString($this->entity_cat,$this->entity_name,$templ_objs,$templates,$this->testgenerator,$this->additionData,$id_entity,$pack);$this->g_count =$respond['count'];$this->seo_data=$respond['seo_data'];} private function setVars_CPBI_urls($entity_cat,$entity_name,$testgenerator,$additionData){ $this->seo_data =array();$this->g_count =0;$this->testgenerator=$testgenerator;$this->entity_cat =$entity_cat;$this->entity_name =$entity_name;$this->additionData =$additionData;} } ?>
