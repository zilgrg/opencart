<?php class geo_helper extends Controller { function __construct(){ global $registry;parent::__construct($registry);} static private $Instance =NULL;static public function getInstance() { if(self::$Instance==NULL){ $class=__CLASS__;self::$Instance=new $class;} return self::$Instance;} public function getCountries($lang,$continent_id=''){ $respond=array();if($continent_id){ $url='http://api.geonames.org/childrenJSON?';$param=array( 'geonameId' => $continent_id,'style' => 'short','lang' => $lang,'maxRows' => '1000','featureCode'=> 'ADM1','username' => 'tumkiv.r' );}else{ $url='http://api.geonames.org/countryInfoJSON?';$param=array( 'style' => 'short','lang' => $lang,'maxRows' => '1000','username' => 'tumkiv.r' );} $url=$url.http_build_query($param);$result_check=get_headers($url);if(filter_var($url,FILTER_VALIDATE_URL) !==false && !strpos($result_check[0],'200')===false){ $result=file_get_contents($url);$results=json_decode($result);foreach ($results->geonames as $result) { $respond[$result->geonameId]=isset($result->name) ? $result->name:$result->countryName;} } return $respond;} public function getTowns($lang,$country,$featureCode=''){ $respond=array();$url='http://api.geonames.org/searchJSON?';$param=array( 'country' => $country,'style' => 'short','lang' => $lang,'maxRows' => '1000','username' => 'tumkiv.r' );$featureCode=$featureCode ? '&featureCode='.$featureCode:'&featureCode=PPLA&featureCode=PPLX';$url=$url.http_build_query($param).$featureCode;$result_check=get_headers($url);if(filter_var($url,FILTER_VALIDATE_URL) !==false && !strpos($result_check[0],'200')===false){ $result=file_get_contents($url);$results=json_decode($result);foreach ($results->geonames as $result) { $respond[]=$result->name;} } return $respond;} } ?>
