<?php class tool extends Controller { function __construct(){ global $registry;parent::__construct($registry);} static private $Instance =NULL;static public function getInstance() { if(self::$Instance==NULL){ $class=__CLASS__;self::$Instance=new $class;} return self::$Instance;} public function get_qr($pageURL) { require_once DIR_CONFIG.'ssb_library/catalog/phpqrcode/qrlib.php';$codeContents=$pageURL;$tempDir=DIR_IMAGE.'ssb_qr_code/';if (isset($this->request->server['HTTPS']) AND (($this->request->server['HTTPS']=='on') || ($this->request->server['HTTPS']=='1'))) { $pageURL=HTTPS_SERVER;}else{ $pageURL=HTTP_SERVER;} $tempPath=$pageURL.'image/ssb_qr_code/';$fileName='qr_'.md5($codeContents).'.png';$pngAbsoluteFilePath=$tempDir.$fileName;$urlRelativeFilePath=$tempPath.$fileName;if (!file_exists($pngAbsoluteFilePath)) { QRcode::png($codeContents,$pngAbsoluteFilePath,QR_ECLEVEL_H,4,1);} return $urlRelativeFilePath;} public function curPageURL() { $pageURL='http';if (isset($this->request->server['HTTPS']) AND (($this->request->server['HTTPS']=='on') || ($this->request->server['HTTPS']=='1'))) {$pageURL.="s";} $pageURL.="://";if ($_SERVER["SERVER_PORT"] !="80") { $pageURL.=$_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"].$_SERVER["REQUEST_URI"];} else { $pageURL.=$_SERVER["SERVER_NAME"].$_SERVER["REQUEST_URI"];} return $pageURL;} } ?>
