<?php class ssb_autogen extends Controller { static private $Instance =NULL;private $ssb_data;private $ssb_helper;function __construct(){ global $registry;parent::__construct($registry);require_once DIR_CONFIG.'ssb_library/ssb_data.php';$this->ssb_data=ssb_data::getInstance();require_once DIR_CONFIG.'ssb_library/ssb_helper.php';$this->ssb_helper=ssb_helper::getInstance();} static public function getInstance() { if(self::$Instance==NULL){ $class=__CLASS__;self::$Instance=new $class;} return self::$Instance;} public function genAutoSeo($CPBI,$item_id){ $data =array('id_entity'=> $item_id);$data['CPBI'] =$CPBI;$entity_data=$this->ssb_data->getSetting('entity');if(!$entity_data){return false;} $generate_status=$this->ssb_data->getEntityStatus('urls','CPBI_urls',$CPBI);if($entity_data['urls']['CPBI_urls']['data'][$CPBI]['auto'] or $generate_status){ $data['entity_name'] ='CPBI_urls';$file_generator=DIR_CONFIG.'ssb_library/admin/generators/gen_urls.php';include_once($file_generator);$generator=gen_urls::getInstance();$gen_data=$generator->generate($data);} if($CPBI=='product' AND $entity_data['images'][$CPBI]['auto']){ $data['entity_cat'] ='images';$data['entity_name'] ='product';$file_generator=DIR_CONFIG.'ssb_library/admin/generators/gen_images.php';include_once($file_generator);$generator=gen_images::getInstance();$gen_data=$generator->generate($data);} if($CPBI=='product' AND $entity_data['related_prod'][$CPBI]['auto']){ $data['entity_cat'] ='related_prod';$data['entity_name'] ='all';$file_generator=DIR_CONFIG.'ssb_library/admin/generators/gen_related_prod.php';include_once($file_generator);$generator=gen_related_prod::getInstance();$gen_data=$generator->generate($data);} if($CPBI=='product' AND $entity_data['reviews'][$CPBI]['auto']){ $sql="SELECT COUNT(*) AS total FROM ".DB_PREFIX."review WHERE product_id = '". $item_id ."' AND auto_gen = '1';";$query_total=$this->db->query($sql);if($query_total->row['total']){return;} $data['entity_cat'] ='reviews';$data['entity_name'] ='product';$file_generator=DIR_CONFIG.'ssb_library/admin/generators/gen_reviews.php';include_once($file_generator);$generator=gen_reviews::getInstance();$gen_data=$generator->generate($data);} $data['entity_name'] =$CPBI;$file_generator=DIR_CONFIG.'ssb_library/admin/generators/gen_TDKT.php';include_once($file_generator);$generator=gen_TDKT::getInstance();$data['additionData']=array('condition'=> 'gen_only_for_empty');if($entity_data['tags'][$CPBI]['auto']){ $data['entity_cat'] ='tags';$gen_data=$generator->generate($data);} if($entity_data['m_descrip'][$CPBI]['auto']){ $data['entity_cat'] ='m_descrip';$gen_data=$generator->generate($data);} if($entity_data['m_keywords'][$CPBI]['auto']){ $data['entity_cat'] ='m_keywords';$gen_data=$generator->generate($data);} if($entity_data['titles'][$CPBI]['auto']){ $data['entity_cat'] ='titles';$gen_data=$generator->generate($data);} if($CPBI !='info' AND $entity_data['seo_h1'][$CPBI]['auto'] ){ $data['entity_cat'] ='seo_h1';$gen_data=$generator->generate($data);} if($CPBI !='info' AND $entity_data['descrip'][$CPBI]['auto']){ $data['entity_cat'] ='descrip';$data['additionData']=array('condition'=> 'gen_only_for_empty');$gen_data=$generator->generate($data);} } } ?>
