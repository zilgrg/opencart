<modification>

    <id>Enables you to select which columns are displayed on overview pages and enables to quick edit the values in place</id>
    <version>2.3.2</version>
    <vqmver>1.0.7</vqmver>
    <author>rmg</author>


<!-- SALES -> COUPONS -->
    <file name="admin/controller/sale/coupon.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerSaleCoupon extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="10"><![CDATA[
            $this->data['coupons'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) {
                $cols = @unserialize($this->config->get('aqe_sales_coupons'));
                $columns = array(
                    'coupon_id'  => $result['coupon_id'],
                    'selected'   => isset($this->request->post['selected']) && in_array($result['coupon_id'], $this->request->post['selected']),
                    'action'     => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['code'] = $result['code'];
                    $columns['discount'] = $result['discount'];
                    $columns['date_start'] = date($this->language->get('date_format_short'), strtotime($result['date_start']));
                    $columns['date_end'] = date($this->language->get('date_format_short'), strtotime($result['date_end']));
                    $columns['status'] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            if (in_array($column, array('date_start', 'date_end'))) {
                                $columns[$column] = date("Y-m-d", strtotime($result[$column]));
                            } else if ($column == 'status') {
                                $columns[$column] = ($result[$column] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                            } else if ($column == 'type') {
                                $columns[$column] = (($result[$column] == 'P') ? $this->language->get('text_percent') : $this->language->get('text_amount'));
                            } else if (in_array($column, array('logged', 'shipping'))) {
                                $columns[$column] = (($result[$column]) ? $this->language->get('text_yes') : $this->language->get('text_no'));
                            } else {
                                $columns[$column] = $result[$column];
                            }
                        }
                    }
                }
                $this->data['coupons'][] = $columns;
            } else {
                $this->data['coupons'][] = array(
                    'coupon_id'  => $result['coupon_id'],
                    'name'       => $result['name'],
                    'code'       => $result['code'],
                    'discount'   => $result['discount'],
                    'date_start' => date($this->language->get('date_format_short'), strtotime($result['date_start'])),
                    'date_end'   => date($this->language->get('date_format_short'), strtotime($result['date_end'])),
                    'status'     => ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled')),
                    'selected'   => isset($this->request->post['selected']) && in_array($result['coupon_id'], $this->request->post['selected']),
                    'action'     => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_action'] = $this->language->get('column_action');
            ]]></search>
            <add><![CDATA[
        $this->data['column_type'] = $this->language->get('column_type');
        $this->data['column_total'] = $this->language->get('column_total');
        $this->data['column_logged'] = $this->language->get('column_logged');
        $this->data['column_shipping'] = $this->language->get('column_shipping');
        $this->data['column_uses_customer'] = $this->language->get('column_uses_customer');
        $this->data['column_uses_total'] = $this->language->get('column_uses_total');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) {
            $cols = @unserialize($this->config->get('aqe_sales_coupons'));
            if (!is_array($cols)) {
                $column_order = array('name', 'code', 'discount', 'date_start', 'date_end', 'status');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('sale/coupon/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['status_select'] = addslashes(json_encode(array("0" => $this->language->get('text_disabled'), "1" => $this->language->get('text_enabled'))));
            $this->data['yes_no_select'] = addslashes(json_encode(array("0" => $this->language->get('text_no'), "1" => $this->language->get('text_yes'))));
            $this->data['type_select'] = addslashes(json_encode(array('P' => $this->language->get('text_percent'), "F" => $this->language->get('text_amount'))));
            $this->data['error_update'] = $this->language->get('error_update');
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['sort_name'] = HTTPS_SERVER . 'index.php?route=sale/coupon&token=' . $this->session->data['token'] . '&sort=name' . $url;
            ]]></search>
            <add><![CDATA[
        $this->data['sort_type'] = $this->url->link('sale/coupon', 'token=' . $this->session->data['token'] . '&sort=type' . $url, 'SSL');
        $this->data['sort_total'] = $this->url->link('sale/coupon', 'token=' . $this->session->data['token'] . '&sort=total' . $url, 'SSL');
        $this->data['sort_logged'] = $this->url->link('sale/coupon', 'token=' . $this->session->data['token'] . '&sort=logged' . $url, 'SSL');
        $this->data['sort_shipping'] = $this->url->link('sale/coupon', 'token=' . $this->session->data['token'] . '&sort=shipping' . $url, 'SSL');
        $this->data['sort_uses_total'] = $this->url->link('sale/coupon', 'token=' . $this->session->data['token'] . '&sort=uses_total' . $url, 'SSL');
        $this->data['sort_uses_customer'] = $this->url->link('sale/coupon', 'token=' . $this->session->data['token'] . '&sort=uses_customer' . $url, 'SSL');
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function quick_update() {
        $this->language->load('sale/coupon');
        $this->load->model('sale/coupon');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            $result = $this->model_sale_coupon->quickEditCoupon($id, $column, $value);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('discount', 'total')))
                    $json['value'] = sprintf("%.4f", round((float)$value, 4));
                else if (in_array($column, array('uses_total', 'uses_customer')))
                    $json['value'] = (int)$value;
                else if ($column == 'status')
                    $json['value'] = ((int)$value) ? $this->language->get('text_enabled') : $this->language->get('text_disabled');
                else if (in_array($column, array('logged', 'shipping')))
                    $json['value'] = ((int)$value) ? $this->language->get('text_yes') : $this->language->get('text_no');
                else if (in_array($column, array('date_start', 'date_end')))
                    $json['value'] = $value;
                else if ($column == 'type')
                    $json['value'] = ($value == 'P') ? $this->language->get('text_percent') : $this->language->get('text_amount');
                else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'sale/coupon')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && (utf8_strlen($data['new']) < 3 || utf8_strlen($data['new']) > 128)) {
            $this->error['warning'] = $this->language->get('error_name');
        }

        if ($column == "code") {
            if (utf8_strlen($data['new']) < 3 || utf8_strlen($data['new']) > 10) {
                $this->error['warning'] = $this->language->get('error_code');
            } else {
                $coupon_info = $this->model_sale_coupon->getCouponByCode($data['new']);
                
                if ($coupon_info) {
                    if (!isset($data['id'])) {
                        $this->error['warning'] = $this->language->get('error_exists');
                    } elseif ($coupon_info['coupon_id'] != $data['id'])  {
                        $this->error['warning'] = $this->language->get('error_exists');
                    }
                }
            }
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/sale/coupon.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_type']         = 'Type';
$_['column_total']        = 'Total Amount';
$_['column_logged']       = 'Customer Login';
$_['column_shipping']     = 'Free Shipping';
$_['column_uses_total']   = 'Uses Per Coupon';
$_['column_uses_customer']  = 'Uses Per Customer';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_code']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/sale/coupon.php">
        <operation>
            <search position="before"><![CDATA[
            public function addCoupon($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditCoupon($coupon_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'code', 'type', 'total', 'logged', 'shipping', 'discount', 'date_start', 'date_end', 'uses_total', 'uses_customer', 'status');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('logged', 'shipping', 'uses_total', 'uses_customer', 'status')))
                $result = $this->db->query("UPDATE `" . DB_PREFIX . "coupon` SET " . $data . " = '" . (int)$value . "' WHERE coupon_id = '" . (int)$coupon_id . "'");
            else if (in_array($data, array('discount', 'total')))
                $result = $this->db->query("UPDATE `" . DB_PREFIX . "coupon` SET " . $data . " = '" . (float)$value . "' WHERE coupon_id = '" . (int)$coupon_id . "'");
            else if (in_array($data, array('name', 'code', 'type', 'date_start', 'date_end')))
                $result = $this->db->query("UPDATE `" . DB_PREFIX . "coupon` SET " . $data . " = '" . $this->db->escape($value) . "' WHERE coupon_id = '" . (int)$coupon_id . "'");
        }
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $sql = "SELECT coupon_id, name, code, discount, date_start, date_end, status FROM " . DB_PREFIX . "coupon";
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) {
            $sql = "SELECT * FROM " . DB_PREFIX . "coupon";
        } else {
            $sql = "SELECT coupon_id, name, code, discount, date_start, date_end, status FROM " . DB_PREFIX . "coupon";
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) {
            $sort_data[] = 'type';
            $sort_data[] = 'total';
            $sort_data[] = 'logged';
            $sort_data[] = 'shipping';
            $sort_data[] = 'uses_total';
            $sort_data[] = 'uses_customer';
        }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/sale/coupon_list.tpl">
        <operation>
            <search position="replace" offset="29"><![CDATA[
            <td class="left"><?php if ($sort == 'cd.name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'code': ?>
              <td class="left"><?php if ($sort == 'code') { ?>
                <a href="<?php echo $sort_code; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_code; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_code; ?>"><?php echo $column_code; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'type': ?>
              <td class="left"><?php if ($sort == 'type') { ?>
                <a href="<?php echo $sort_type; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_type; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_type; ?>"><?php echo $column_type; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'total': ?>
              <td class="right"><?php if ($sort == 'total') { ?>
                <a href="<?php echo $sort_total; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_total; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_total; ?>"><?php echo $column_total; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'logged': ?>
              <td class="left"><?php if ($sort == 'logged') { ?>
                <a href="<?php echo $sort_logged; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_logged; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_logged; ?>"><?php echo $column_logged; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'shipping': ?>
              <td class="left"><?php if ($sort == 'shipping') { ?>
                <a href="<?php echo $sort_shipping; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_shipping; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_shipping; ?>"><?php echo $column_shipping; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'discount': ?>
              <td class="right"><?php if ($sort == 'discount') { ?>
                <a href="<?php echo $sort_discount; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_discount; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_discount; ?>"><?php echo $column_discount; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'date_start': ?>
              <td class="left"><?php if ($sort == 'date_start') { ?>
                <a href="<?php echo $sort_date_start; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_start; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_start; ?>"><?php echo $column_date_start; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'date_end': ?>
              <td class="left"><?php if ($sort == 'date_end') { ?>
                <a href="<?php echo $sort_date_end; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_end; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_end; ?>"><?php echo $column_date_end; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'uses_total': ?>
              <td class="left"><?php if ($sort == 'uses_total') { ?>
                <a href="<?php echo $sort_uses_total; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_uses_total; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_uses_total; ?>"><?php echo $column_uses_total; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'uses_customer': ?>
              <td class="left"><?php if ($sort == 'uses_customer') { ?>
                <a href="<?php echo $sort_uses_customer; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_uses_customer; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_uses_customer; ?>"><?php echo $column_uses_customer; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left"><?php if ($sort == 'status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'cd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.code') { ?>
                <a href="<?php echo $sort_code; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_code; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_code; ?>"><?php echo $column_code; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'c.discount') { ?>
                <a href="<?php echo $sort_discount; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_discount; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_discount; ?>"><?php echo $column_discount; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.date_start') { ?>
                <a href="<?php echo $sort_date_start; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_start; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_start; ?>"><?php echo $column_date_start; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.date_end') { ?>
                <a href="<?php echo $sort_date_end; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_end; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_end; ?>"><?php echo $column_date_end; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="5"><![CDATA[
            <td class="left"><?php echo $coupon['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['name']; ?></td>
                        <?php break;
                    case 'code': ?>
              <td class="left code<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['code']; ?></td>
                        <?php break;
                    case 'type': ?>
              <td class="left type<?php echo ($column_info[$col]['qe_status']) ? ' type_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['type']; ?></td>
                        <?php break;
                    case 'total': ?>
              <td class="right total<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['total']; ?></td>
                        <?php break;
                    case 'logged': ?>
              <td class="left logged<?php echo ($column_info[$col]['qe_status']) ? ' yes_no_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['logged']; ?></td>
                        <?php break;
                    case 'shipping': ?>
              <td class="left shipping<?php echo ($column_info[$col]['qe_status']) ? ' yes_no_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['shipping']; ?></td>
                        <?php break;
                    case 'discount': ?>
              <td class="right discount<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['discount']; ?></td>
                        <?php break;
                    case 'date_start': ?>
              <td class="left date_start<?php echo ($column_info[$col]['qe_status']) ? ' date_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['date_start']; ?></td>
                        <?php break;
                    case 'date_end': ?>
              <td class="left date_end<?php echo ($column_info[$col]['qe_status']) ? ' date_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['date_end']; ?></td>
                        <?php break;
                    case 'uses_total': ?>
              <td class="left uses_total<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['uses_total']; ?></td>
                        <?php break;
                    case 'uses_customer': ?>
              <td class="left uses_customer<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['uses_customer']; ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left status<?php echo ($column_info[$col]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $coupon['coupon_id']; ?>"><?php echo $coupon['status']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $coupon['name']; ?></td>
              <td class="left"><?php echo $coupon['code']; ?></td>
              <td class="right"><?php echo $coupon['discount']; ?></td>
              <td class="left"><?php echo $coupon['date_start']; ?></td>
              <td class="left"><?php echo $coupon['date_end']; ?></td>
              <td class="left"><?php echo $coupon['status']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="8"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="8"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_coupons_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

 $(".status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".type_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($type_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".yes_no_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($yes_no_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".date_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      type      : 'date_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "ignore",
  });
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- SALES -> CUSTOMERS -->
    <file name="admin/controller/sale/customer.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerSaleCustomer extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            private function getList()
            ]]></search>
            <add><![CDATA[
            if (isset($this->request->get['filter_telephone'])) {
                $filter_telephone = $this->request->get['filter_telephone'];
            } else {
                $filter_telephone = null;
            }

            if (isset($this->request->get['filter_fax'])) {
                $filter_fax = $this->request->get['filter_fax'];
            } else {
                $filter_fax = null;
            }

            if (isset($this->request->get['filter_newsletter'])) {
                $filter_newsletter = $this->request->get['filter_newsletter'];
            } else {
                $filter_newsletter = null;
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            $url .= '&filter_name=' . $this->request->get['filter_name'];
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) {
            if (isset($this->request->get['filter_telephone'])) {
                $url .= '&filter_telephone=' . $this->request->get['filter_telephone'];
            }

            if (isset($this->request->get['filter_fax'])) {
                $url .= '&filter_fax=' . $this->request->get['filter_fax'];
            }

            if (isset($this->request->get['filter_newsletter'])) {
                $url .= '&filter_newsletter=' . $this->request->get['filter_newsletter'];
            }
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            'filter_name'              => $filter_name,
            ]]></search>
            <add><![CDATA[
            'filter_telephone'         => $filter_telephone,
            'filter_fax'               => $filter_fax,
            'filter_newsletter'        => $filter_newsletter,
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="11"><![CDATA[
            $this->data['customers'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) {
                $cp_cols = @unserialize($this->config->get('aqe_sales_customers'));
                $columns = array(
                    'customer_id' => $result['customer_id'],
                    'selected'    => isset($this->request->post['selected']) && in_array($result['customer_id'], $this->request->post['selected']),
                    'action'      => $action
                );
                if (!is_array($cp_cols)) {
                    $columns['name'] = $result['name'];
                    $columns['email'] = $result['email'];
                    $columns['customer_group'] = $result['customer_group'];
                    $columns['status'] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                    $columns['approved'] = ($result['approved'] ? $this->language->get('text_yes') : $this->language->get('text_no'));
                    $columns['ip'] = $result['ip'];
                    $columns['date_added'] = date($this->language->get('date_format_short'), strtotime($result['date_added']));
                } else {
                    foreach($cp_cols as $column => $attr) {
                        if ($attr['display']) {
                            if ($column == 'status')
                                $columns[$column] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                            else if (in_array($column, array('newsletter', 'approved')))
                                $columns[$column] = ($result[$column] ? $this->language->get('text_yes') : $this->language->get('text_no'));
                            else if ($column == 'date_added')
                                $columns[$column] = date($this->language->get('date_format_short'), strtotime($result['date_added']));
                            else
                                $columns[$column] = $result[$column];
                        }
                    }
                }
                $this->data['customers'][] = $columns;
            } else {
                $this->data['customers'][] = array(
                    'customer_id'    => $result['customer_id'],
                    'name'           => $result['name'],
                    'email'          => $result['email'],
                    'customer_group' => $result['customer_group'],
                    'status'         => ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled')),
                    'approved'       => ($result['approved'] ? $this->language->get('text_yes') : $this->language->get('text_no')),
                    'ip'             => $result['ip'],
                    'date_added'     => date($this->language->get('date_format_short'), strtotime($result['date_added'])),
                    'selected'       => isset($this->request->post['selected']) && in_array($result['customer_id'], $this->request->post['selected']),
                    'action'         => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_action'] = $this->language->get('column_action');
            ]]></search>
            <add><![CDATA[
        $this->data['column_telephone'] = $this->language->get('column_telephone');
        $this->data['column_fax'] = $this->language->get('column_fax');
        $this->data['column_newsletter'] = $this->language->get('column_newsletter');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_filter'] = $this->language->get('button_filter');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) {
            $cp_cols = @unserialize($this->config->get('aqe_sales_customers'));
            if (!is_array($cp_cols)) {
                $column_order = array('name', 'email', 'customer_group', 'status', 'ip', 'date_added');
                $cp_cols = array();
            } else {
                $column_order = array();
                uasort($cp_cols, 'column_sort');

                foreach($cp_cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cp_cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('sale/customer/quick_update', 'token=' . $this->session->data['token'], 'SSL'));
            $this->data['status_select'] = addslashes(json_encode(array("0" => $this->language->get('text_disabled'), "1" => $this->language->get('text_enabled'))));
            $this->data['yes_no_select'] = addslashes(json_encode(array("0" => $this->language->get('text_no'), "1" => $this->language->get('text_yes'))));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('sale/customer/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('sale/customer_group');
            $customer_groups = $this->model_sale_customer_group->getCustomerGroups();
            $c_select = array();
            foreach ($customer_groups as $c) {
                $c_select[$c['customer_group_id']] = $c['name'];
            }
            $this->data['customer_group_select'] = addslashes(json_encode($c_select));
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['sort_name'] = $this->url->link('sale/customer', 'token=' . $this->session->data['token'] . '&sort=name' . $url, 'SSL');
            ]]></search>
            <add><![CDATA[
        $this->data['sort_telephone'] = $this->url->link('sale/customer', 'token=' . $this->session->data['token'] . '&sort=c.telephone' . $url, 'SSL');
        $this->data['sort_fax'] = $this->url->link('sale/customer', 'token=' . $this->session->data['token'] . '&sort=c.fax' . $url, 'SSL');
        $this->data['sort_newsletter'] = $this->url->link('sale/customer', 'token=' . $this->session->data['token'] . '&sort=c.newsletter' . $url, 'SSL');
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['filter_name'] = $filter_name;
            ]]></search>
            <add><![CDATA[
        $this->data['filter_telephone'] = $filter_telephone;
        $this->data['filter_fax'] = $filter_fax;
        $this->data['filter_newsletter'] = $filter_newsletter;
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);

            $this->load->model('sale/customer');
            $result = $this->model_sale_customer->getCustomer($id);
            if ($result) {
                $json['first_name'] = $result['firstname'];
                $json['last_name'] = $result['lastname'];
            } else {
                $this->language->load('sale/customer');
                $json['error'] = $this->language->get('error_load_name');
            }
        } else {
            $this->language->load('catalog/product');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('sale/customer');
        $this->load->model('sale/customer');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            $result = $this->model_sale_customer->quickEditCustomer($id, $column, $value);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('email', 'telephone', 'fax')))
                    $json['value'] = $value;
                else if ($column == 'status')
                    $json['value'] = ((int)$value) ? $this->language->get('text_enabled') : $this->language->get('text_disabled');
                else if (in_array($column, array('approved', 'newsletter')))
                    $json['value'] = ((int)$value) ? $this->language->get('text_yes') : $this->language->get('text_no');
                else if ($column == 'customer_group') {
                    $this->load->model('sale/customer_group');
                    $customer_group = $this->model_sale_customer_group->getCustomerGroup((int)$value);
                    if ($customer_group)
                        $json['value'] = $customer_group['name'];
                    else
                        $json['value'] = '';
                } else if($column == 'name') {
                        $json['value'] = str_replace("||", " ", $value);
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'sale/customer')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'sale/customer')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && strpos($data['new'], "||") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name") {
            list($first, $last) = explode("||", $data['new']);
            if (utf8_strlen($first) < 1 || utf8_strlen($first) > 32)
                $this->error['warning'] = $this->language->get('error_firstname');
            else if (utf8_strlen($last) < 1 || utf8_strlen($last) > 32)
                $this->error['warning'] = $this->language->get('error_lastname');
        }
        
        if ($column == "email" && ((utf8_strlen($data['new']) > 96) || !preg_match('/^[^\@]+@.*\.[a-z]{2,6}$/i', $data['new']))) {
            $this->error['warning'] = $this->language->get('error_email');
        }

        if ($column == "telephone" && ((utf8_strlen($data['new']) < 3) || utf8_strlen($data['new']) > 32)) {
            $this->error['warning'] = $this->language->get('error_telephone');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/sale/customer.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_telephone']       = 'Telephone';
$_['column_fax']             = 'Fax';
$_['column_newsletter']      = 'Newsletter';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_zone']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/sale/customer.php">
        <operation>
            <search position="before"><![CDATA[
            public function addCustomer($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditCustomer($customer_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'email', 'telephone', 'fax', 'newsletter', 'customer_group', 'approved', 'status');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('email', 'telephone', 'fax')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "customer SET " . $data . " = '" . $this->db->escape($value) . "' WHERE customer_id = '" . (int)$customer_id . "'");
            else if (in_array($data, array('newsletter', 'approved', 'status')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "customer SET " . $data . " = '" . (int)$value . "' WHERE customer_id = '" . (int)$customer_id . "'");
            else if ($data == "customer_group")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "customer SET customer_group_id = '" . (int)$value . "' WHERE customer_id = '" . (int)$customer_id . "'");
            else if ($data == "name") {
                list($first_name, $last_name) = explode("||", $value);
                $result = $this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($first_name) . "', lastname = '" . $this->db->escape($last_name) . "' WHERE customer_id = '" . (int)$customer_id . "'");
            }
        }
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (!empty($data['filter_name'])) {
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) {
            if (!empty($data['filter_telephone'])) {
                $implode[] = "telephone LIKE '%" . $this->db->escape($data['filter_telephone']) . "%'";
            }

            if (!empty($data['filter_fax'])) {
                $implode[] = "fax LIKE '%" . $this->db->escape($data['filter_fax']) . "%'";
            }

            if (isset($data['filter_newsletter']) && !is_null($data['filter_newsletter'])) {
                $implode[] = "newsletter = '" . (int)$data['filter_newsletter'] . "'";
            }
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) {
            $sort_data[] = 'c.telephone';
            $sort_data[] = 'c.fax';
            $sort_data[] = 'c.newsletter';
        }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/sale/customer_list.tpl">
        <operation>
            <search position="replace" offset="34"><![CDATA[
            <td class="left"><?php if ($sort == 'name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'email': ?>
              <td class="left"><?php if ($sort == 'c.email') { ?>
                <a href="<?php echo $sort_email; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_email; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_email; ?>"><?php echo $column_email; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'telephone': ?>
              <td class="left"><?php if ($sort == 'c.telephone') { ?>
                <a href="<?php echo $sort_telephone; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_telephone; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_telephone; ?>"><?php echo $column_telephone; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'fax': ?>
              <td class="left"><?php if ($sort == 'c.fax') { ?>
                <a href="<?php echo $sort_fax; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_fax; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_fax; ?>"><?php echo $column_fax; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'newsletter': ?>
              <td class="left"><?php if ($sort == 'c.newsletter') { ?>
                <a href="<?php echo $sort_newsletter; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_newsletter; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_newsletter; ?>"><?php echo $column_newsletter; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'customer_group': ?>
              <td class="left"><?php if ($sort == 'customer_group') { ?>
                <a href="<?php echo $sort_customer_group; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_customer_group; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_customer_group; ?>"><?php echo $column_customer_group; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left"><?php if ($sort == 'c.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'approved': ?>
              <td class="left"><?php if ($sort == 'c.approved') { ?>
                <a href="<?php echo $sort_approved; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_approved; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_approved; ?>"><?php echo $column_approved; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'ip': ?>
              <td class="left"><?php if ($sort == 'c.ip') { ?>
                <a href="<?php echo $sort_ip; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_ip; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_ip; ?>"><?php echo $column_ip; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'date_added': ?>
              <td class="left"><?php if ($sort == 'c.date_added') { ?>
                <a href="<?php echo $sort_date_added; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_added; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_added; ?>"><?php echo $column_date_added; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.email') { ?>
                <a href="<?php echo $sort_email; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_email; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_email; ?>"><?php echo $column_email; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'customer_group') { ?>
                <a href="<?php echo $sort_customer_group; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_customer_group; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_customer_group; ?>"><?php echo $column_customer_group; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.approved') { ?>
                <a href="<?php echo $sort_approved; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_approved; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_approved; ?>"><?php echo $column_approved; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.ip') { ?>
                <a href="<?php echo $sort_ip; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_ip; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_ip; ?>"><?php echo $column_ip; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'c.date_added') { ?>
                <a href="<?php echo $sort_date_added; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_added; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_added; ?>"><?php echo $column_date_added; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="41"><![CDATA[
            <tr class="filter">
            ]]></search>
            <add><![CDATA[
            <tr class="filter">
              <td></td>
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td><input type="text" name="filter_name" value="<?php echo $filter_name; ?>" /></td>
                        <?php break;
                    case 'email': ?>
              <td><input type="text" name="filter_email" value="<?php echo $filter_email; ?>" /></td>
                        <?php break;
                    case 'telephone': ?>
              <td><input type="text" name="filter_telephone" value="<?php echo $filter_telephone; ?>" /></td>
                        <?php break;
                    case 'fax': ?>
              <td><input type="text" name="filter_fax" value="<?php echo $filter_fax; ?>" /></td>
                        <?php break;
                    case 'newsletter': ?>
              <td><select name="filter_newsletter">
                  <option value="*"></option>
                  <?php if ($filter_newsletter) { ?>
                  <option value="1" selected="selected"><?php echo $text_yes; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_yes; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_newsletter) && !$filter_newsletter) { ?>
                  <option value="0" selected="selected"><?php echo $text_no; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_no; ?></option>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'customer_group': ?>
              <td><select name="filter_customer_group_id">
                  <option value="*"></option>
                  <?php foreach ($customer_groups as $customer_group) { ?>
                  <?php if ($customer_group['customer_group_id'] == $filter_customer_group_id) { ?>
                  <option value="<?php echo $customer_group['customer_group_id']; ?>" selected="selected"><?php echo $customer_group['name']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $customer_group['customer_group_id']; ?>"><?php echo $customer_group['name']; ?></option>
                  <?php } ?>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'status': ?>
              <td><select name="filter_status">
                  <option value="*"></option>
                  <?php if ($filter_status) { ?>
                  <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_enabled; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_status) && !$filter_status) { ?>
                  <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_disabled; ?></option>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'approved': ?>
              <td><select name="filter_approved">
                  <option value="*"></option>
                  <?php if ($filter_approved) { ?>
                  <option value="1" selected="selected"><?php echo $text_yes; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_yes; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_approved) && !$filter_approved) { ?>
                  <option value="0" selected="selected"><?php echo $text_no; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_no; ?></option>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'ip': ?>
              <td><input type="text" name="filter_ip" value="<?php echo $filter_ip; ?>" /></td>
                        <?php break;
                    case 'date_added': ?>
              <td><input type="text" name="filter_date_added" value="<?php echo $filter_date_added; ?>" size="12" id="date" /></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td><input type="text" name="filter_name" value="<?php echo $filter_name; ?>" /></td>
              <td><input type="text" name="filter_email" value="<?php echo $filter_email; ?>" /></td>
              <td><select name="filter_customer_group_id">
                  <option value="*"></option>
                  <?php foreach ($customer_groups as $customer_group) { ?>
                  <?php if ($customer_group['customer_group_id'] == $filter_customer_group_id) { ?>
                  <option value="<?php echo $customer_group['customer_group_id']; ?>" selected="selected"><?php echo $customer_group['name']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $customer_group['customer_group_id']; ?>"><?php echo $customer_group['name']; ?></option>
                  <?php } ?>
                  <?php } ?>
                </select></td>
              <td><select name="filter_status">
                  <option value="*"></option>
                  <?php if ($filter_status) { ?>
                  <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_enabled; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_status) && !$filter_status) { ?>
                  <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_disabled; ?></option>
                  <?php } ?>
                </select></td>
              <td><select name="filter_approved">
                  <option value="*"></option>
                  <?php if ($filter_approved) { ?>
                  <option value="1" selected="selected"><?php echo $text_yes; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_yes; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_approved) && !$filter_approved) { ?>
                  <option value="0" selected="selected"><?php echo $text_no; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_no; ?></option>
                  <?php } ?>
                </select></td>
              <td><input type="text" name="filter_ip" value="<?php echo $filter_ip; ?>" /></td>
              <td><input type="text" name="filter_date_added" value="<?php echo $filter_date_added; ?>" size="12" id="date" /></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            <td class="left"><?php echo $customer['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['name']; ?></td>
                        <?php break;
                    case 'email': ?>
              <td class="left email<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['email']; ?></td>
                        <?php break;
                    case 'telephone': ?>
              <td class="left telephone<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['telephone']; ?></td>
                        <?php break;
                    case 'fax': ?>
              <td class="left fax<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['fax']; ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left status<?php echo ($column_info[$col]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['status']; ?></td>
                        <?php break;
                    case 'customer_group': ?>
              <td class="left customer_group<?php echo ($column_info[$col]['qe_status']) ? ' customer_group_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['customer_group']; ?></td>
                        <?php break;
                    case 'approved': ?>
              <td class="left approved<?php echo ($column_info[$col]['qe_status']) ? ' yes_no_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['approved']; ?></td>
                        <?php break;
                    case 'newsletter': ?>
              <td class="left newsletter<?php echo ($column_info[$col]['qe_status']) ? ' yes_no_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['newsletter']; ?></td>
                        <?php break;
                    case 'ip': ?>
              <td class="left ip<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['ip']; ?></td>
                        <?php break;
                    case 'date_added': ?>
              <td class="left date_added<?php echo ($column_info[$col]['qe_status']) ? ' date_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $customer['customer_id']; ?>"><?php echo $customer['date_added']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $customer['name']; ?></td>
              <td class="left"><?php echo $customer['email']; ?></td>
              <td class="left"><?php echo $customer['customer_group']; ?></td>
              <td class="left"><?php echo $customer['status']; ?></td>
              <td class="left"><?php echo $customer['approved']; ?></td>
              <td class="left"><?php echo $customer['ip']; ?></td>
              <td class="left"><?php echo $customer['date_added']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="10"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 3; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="10"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="before"><![CDATA[
            function filter() {
            ]]></search>
            <add><![CDATA[
$('#form input').keydown(function(e) {
    if (e.keyCode == 13) {
        filter();
    }
});
            ]]></add>
        </operation>
        <operation error="log">
            <search position="before"><![CDATA[
            var filter_name = $('input[name=\'filter_name\']').attr('value');
            ]]></search>
            <add><![CDATA[
    var filter_telephone = $('input[name=\'filter_telephone\']').attr('value');

    if (filter_telephone) {
        url += '&filter_telephone=' + encodeURIComponent(filter_telephone);
    }

    var filter_fax = $('input[name=\'filter_fax\']').attr('value');

    if (filter_fax) {
        url += '&filter_fax=' + encodeURIComponent(filter_fax);
    }

    var filter_newsletter = $('select[name=\'filter_newsletter\']').attr('value');

    if (filter_newsletter && filter_newsletter != '*') {
        url += '&filter_newsletter=' + encodeURIComponent(filter_newsletter);
    }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_customers_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

 $(".status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".yes_no_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($yes_no_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".customer_group_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($customer_group_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".name_quick_edit").editable(function(value, settings) {
    var name = $('#first_name', this).val() + '||' + $('#last_name', this).val();
    return quick_update(this, name, settings);
  }, {
      type      : 'customer_name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
  });
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- SALES -> ORDERS -->
    <file name="admin/controller/sale/order.php">
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_filter'] = $this->language->get('button_filter');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_orders_status')) {
            $cols = @unserialize($this->config->get('aqe_sales_orders'));
            if (!is_array($cols)) {
                $cols = array();
            }
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('sale/order/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/order_status');
            $order_statuses = $this->model_localisation_order_status->getOrderStatuses();
            $status_select = array();
            foreach ($order_statuses as $status) {
                $status_select[$status['order_status_id']] = $status['name'];
            }
            $this->data['status_select'] = addslashes(json_encode($status_select));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['text_notify_customer'] = $this->language->get('text_notify_customer');
            $this->data['notify_customer'] = $this->config->get('aqe_sales_orders_notify_customer');
            $this->data['error_update'] = $this->language->get('error_update');
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function quick_update() {
        $this->load->language('sale/order');
        $this->load->model('sale/order');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $order_id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if (isset($this->request->post['notify'])) {
                $notify = $this->request->post['notify'];
            } else {
                $notify = $this->config->get('aqe_sales_orders_notify_customer');
            }
            $data = array();
            $data['notify'] = $notify;
            $data['comment'] = "";
            $data['order_status_id'] = $value;
            if ($column == "status") {
                $this->model_sale_order->addOrderHistory($order_id, $data);
                $result = true;
            } else
                $result = false;
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('status'))) {
                    $this->load->model('localisation/order_status');
                    $status = $this->model_localisation_order_status->getOrderStatus($value);
                    $json['value'] = $status['name'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'sale/order')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>

    <file name="admin/language/*/sale/order.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
$_['text_notify_customer']   = 'Notify Customer';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_action']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/sale/order_list.tpl">
        <operation>
            <search position="replace"><![CDATA[
            <td class="left"><?php echo $order['status']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_orders_status')) { ?>
              <td class="left<?php echo (isset($column_info["status"]) && $column_info["status"]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo "status-" . $order['order_id']; ?>"><?php echo $order['status']; ?></td>
            <?php } else { ?>
              <td class="left"><?php echo $order['status']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_sales_orders_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
 $(".status_quick_edit").editable(function(value, settings) {
    var notify = $('#notify', this).is(':checked') ? 1 : 0;
    var params = {notify: notify};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'status_edit',
      data      : '<?php echo trim($status_select); ?>',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      notify_customer_text : '<?php echo $text_notify_customer; ?>',
      notify_customer      : '<?php echo $notify_customer; ?>',
  });
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> INFORMATION -->
    <file name="admin/controller/catalog/information.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogInformation extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            $this->data['informations'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_information'));
                $columns = array(
                    'information_id' => $result['information_id'],
                    'selected'       => isset($this->request->post['selected']) && in_array($result['information_id'], $this->request->post['selected']),
                    'action'         => $action
                );
                if (!is_array($cols)) {
                    $columns['title'] = $result['title'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            if ($column == 'status') {
                                $columns[$column] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                            } else {
                                $columns[$column] = $result[$column];
                            }
                        }
                    }
                }
                $this->data['informations'][] = $columns;
            } else {
                $this->data['informations'][] = array(
                    'information_id' => $result['information_id'],
                    'title'          => $result['title'],
                    'sort_order'     => $result['sort_order'],
                    'selected'       => isset($this->request->post['selected']) && in_array($result['information_id'], $this->request->post['selected']),
                    'action'         => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_action'] = $this->language->get('column_action');
            ]]></search>
            <add><![CDATA[
        $this->data['column_seo'] = $this->language->get('column_seo');
        $this->data['column_status'] = $this->language->get('column_status');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_information'));
            if (!is_array($cols)) {
                $column_order = array('title', 'sort_order');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/information/quick_update', 'token=' . $this->session->data['token'], 'SSL'));
            $this->data['status_select'] = addslashes(json_encode(array("0" => $this->language->get('text_disabled'), "1" => $this->language->get('text_enabled'))));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_title_url'] = html_entity_decode($this->url->link('catalog/information/load_title', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['sort_title'] = $this->url->link('catalog/information', 'token=' . $this->session->data['token'] . '&sort=id.title' . $url, 'SSL');
            ]]></search>
            <add><![CDATA[
        $this->data['sort_seo'] = $this->url->link('catalog/information', 'token=' . $this->session->data['token'] . '&sort=seo' . $url, 'SSL');
        $this->data['sort_status'] = $this->url->link('catalog/information', 'token=' . $this->session->data['token'] . '&sort=i.status' . $url, 'SSL');
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_title() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/information');
            $result = $this->model_catalog_information->getInformationDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['title']);
            }
        } else {
            $this->language->load('catalog/information');
            $json['error'] = $this->language->get('error_load_title');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/information');
        $this->load->model('catalog/information');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "title") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_information->quickEditInformation($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('seo')))
                    $json['value'] = $value;
                else if (in_array($column, array('sort_order')))
                    $json['value'] = (int)$value;
                else if ($column == 'status')
                    $json['value'] = ((int)$value) ? $this->language->get('text_enabled') : $this->language->get('text_disabled');
                else if($column == 'title') {
                    if ($lang_id == $this->config->get('config_language_id')) {
                        $json['value'] = $value;
                    } else
                        $json['value'] = $this->request->post['old'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/information')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "title") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/information')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "title" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "title" && (strlen(utf8_decode($data['new'])) < 3) || (strlen(utf8_decode($data['new'])) > 64)) {
            $this->error['warning'] = $this->language->get('error_title');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/information.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_seo']             = 'SEO Keyword';
$_['column_status']          = 'Status';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_title']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_title']       = 'Warning: Loading title data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/information.php">
        <operation>
            <search position="before"><![CDATA[
            public function addInformation($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditInformation($information_id, $data, $value, $lang_id=null) {
        $editable = array('title', 'status', 'sort_order');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('sort_order', 'status')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "information SET `" . $data . "` = '" . (int)$value . "' WHERE information_id = '" . (int)$information_id . "'");
            else if ($data == "title")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "information_description SET title = '" . $this->db->escape($value) . "' WHERE information_id = '" . (int)$information_id . "' AND language_id = '" . (int)$lang_id . "'");
        } else if ($data == 'seo') {
            $this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'information_id=" . (int)$information_id. "'");
            if (!empty($value))
                $result = $this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'information_id=" . (int)$information_id . "', keyword = '" . $this->db->escape($value) . "'");
            else
                $result = 1;
        }
        $this->cache->delete('information');
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $sql = "SELECT * FROM " . DB_PREFIX . "information i LEFT JOIN " . DB_PREFIX . "information_description id ON (i.information_id = id.information_id) WHERE id.language_id = '" . (int)$this->config->get('config_language_id') . "'";
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) {
			//Paladin  AND language_id = '" . (int)$this->config->get('config_language_id') . "'
            $sql = "SELECT i.*, id.*, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('information_id=', i.information_id) AND language_id = '" . (int)$this->config->get('config_language_id') . "') AS seo FROM " . DB_PREFIX . "information i LEFT JOIN " . DB_PREFIX . "information_description id ON (i.information_id = id.information_id) WHERE id.language_id = '" . (int)$this->config->get('config_language_id') . "'";
        } else {
            $sql = "SELECT * FROM " . DB_PREFIX . "information i LEFT JOIN " . DB_PREFIX . "information_description id ON (i.information_id = id.information_id) WHERE id.language_id = '" . (int)$this->config->get('config_language_id') . "'";
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) {
            $sort_data[] = 'i.status';
            $sort_data[] = 'seo';
        }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "information i LEFT JOIN " . DB_PREFIX . "information_description id ON (i.information_id = id.information_id) WHERE id.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY id.title");
            ]]></search>
            <add><![CDATA[
                if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) {
					//Paladin  AND language_id = '" . (int)$this->config->get('config_language_id') . "'
                    $query = $this->db->query("SELECT i.*, id.*, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('information_id=', i.information_id) AND language_id = '" . (int)$this->config->get('config_language_id') . "') AS seo FROM " . DB_PREFIX . "information i LEFT JOIN " . DB_PREFIX . "information_description id ON (i.information_id = id.information_id) WHERE id.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY id.title");
                } else {
                    $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "information i LEFT JOIN " . DB_PREFIX . "information_description id ON (i.information_id = id.information_id) WHERE id.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY id.title");
                }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/information_list.tpl">
        <operation>
            <search position="replace" offset="9"><![CDATA[
            <td class="left"><?php if ($sort == 'id.title') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'title': ?>
              <td class="left"><?php if ($sort == 'id.title') { ?>
                <a href="<?php echo $sort_title; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_title; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_title; ?>"><?php echo $column_title; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left"><?php if ($sort == 'i.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php if ($sort == 'i.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left"><?php if ($sort == 'seo') { ?>
                <a href="<?php echo $sort_seo; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_seo; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_seo; ?>"><?php echo $column_seo; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'id.title') { ?>
                <a href="<?php echo $sort_title; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_title; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_title; ?>"><?php echo $column_title; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'i.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $information['title']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'title': ?>
              <td class="left title<?php echo ($column_info[$col]['qe_status']) ? ' title_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $information['information_id']; ?>"><?php echo $information['title']; ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left status<?php echo ($column_info[$col]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $information['information_id']; ?>"><?php echo $information['status']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $information['information_id']; ?>"><?php echo $information['sort_order']; ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left seo<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $information['information_id']; ?>"><?php echo $information['seo']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $information['title']; ?></td>
              <td class="right"><?php echo $information['sort_order']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_information_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

 $(".status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
<?php if ($single_lang_editing) { ?>
 $(".title_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
 $(".title_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_title_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> REVIEWS -->
    <file name="admin/controller/catalog/review.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogReview extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="9"><![CDATA[
            $this->data['reviews'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_reviews'));
                $columns = array(
                    'review_id' => $result['review_id'],
                    'selected'  => isset($this->request->post['selected']) && in_array($result['review_id'], $this->request->post['selected']),
                    'action'    => $action
                );
                if (!is_array($cols)) {
                    $columns['product'] = $result['name'];
                    $columns['author'] = $result['author'];
                    $columns['rating'] = $result['rating'];
                    $columns['status'] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                    $columns['date_added'] = date($this->language->get('date_format_short'), strtotime($result['date_added']));
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            if ($column == 'product') {
                                $columns[$column] = $result['name'];
                            } else if ($column == 'status') {
                                $columns[$column] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                            } else if ($column == 'date_added') {
                                $columns[$column] = date("Y-m-d H:i", strtotime($result['date_added']));
                            } else {
                                $columns[$column] = $result[$column];
                            }
                        }
                    }
                }
                $this->data['reviews'][] = $columns;
            } else {
                $this->data['reviews'][] = array(
                    'review_id'  => $result['review_id'],
                    'name'       => $result['name'],
                    'author'     => $result['author'],
                    'rating'     => $result['rating'],
                    'status'     => ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled')),
                    'date_added' => date($this->language->get('date_format_short'), strtotime($result['date_added'])),
                    'selected'   => isset($this->request->post['selected']) && in_array($result['review_id'], $this->request->post['selected']),
                    'action'     => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_action'] = $this->language->get('column_action');
            ]]></search>
            <add><![CDATA[
        $this->data['column_text'] = $this->language->get('column_text');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_reviews'));
            if (!is_array($cols)) {
                $column_order = array('product', 'author', 'rating', 'status', 'date_added');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/review/quick_update', 'token=' . $this->session->data['token'], 'SSL'));
            $this->data['status_select'] = addslashes(json_encode(array("0" => $this->language->get('text_disabled'), "1" => $this->language->get('text_enabled'))));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['token'] = $this->session->data['token'];
            $this->data['language_id'] = $this->config->get('config_language_id');
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function quick_update() {
        $this->language->load('catalog/review');
        $this->load->model('catalog/review');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            $result = $this->model_catalog_review->quickEditReview($id, $column, $value);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('author', 'text')))
                    $json['value'] = $value;
                else if (in_array($column, array('rating')))
                    $json['value'] = (int)$value < 1 ? 1 : (int)$value > 5 ? 5 : (int)$value;
                else if ($column == 'status')
                    $json['value'] = ((int)$value) ? $this->language->get('text_enabled') : $this->language->get('text_disabled');
                else if($column == 'product') {
                    $this->load->model('catalog/review');
                    $review = $this->model_catalog_review->getReview($id);
                    $json['value'] = $review['product'];
                } else if($column == 'date_added') {
                    $json['value'] = $value;
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/review')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "author" && (utf8_strlen($data['new']) < 3 || utf8_strlen($data['new']) > 64)) {
            $this->error['warning'] = $this->language->get('error_author');
        }

        if ($column == "text" && utf8_strlen($data['new']) < 1) {
            $this->error['warning'] = $this->language->get('error_text');
        }

        if ($column == "date_added") {
            if (preg_match("/^(19|20)\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0-3]):[0-5][0-9]$/", $data['new'])) {
                list($date, $time) = explode(' ', $data['new']);
                list($year , $month , $day) = explode('-', $date);
                if (!checkdate($month , $day , $year)) {
                    $this->error['warning'] = $this->language->get('error_invalid_date');
                }
            } else {
                $this->error['warning'] = $this->language->get('error_date_format');
            }
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/review.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_text']            = 'Text';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_product']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_date_format']      = 'Warning: Date format is not recognized! Must be \'YYYY-MM-DD HH:MM\'';
$_['error_invalid_date']     = 'Warning: Date is not valid!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/review.php">
        <operation>
            <search position="before"><![CDATA[
            public function addReview($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditReview($review_id, $data, $value, $lang_id=null) {
        $editable = array('product', 'author', 'text', 'rating', 'status', 'date_added');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('status')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "review SET `" . $data . "` = '" . (int)$value . "', date_modified = NOW() WHERE review_id = '" . (int)$review_id . "'");
            else if ($data == "product")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "review SET product_id = '" . (int)$value . "', date_modified = NOW()  WHERE review_id = '" . (int)$review_id . "'");
            else if ($data == "author")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "review SET author = '" . $this->db->escape($value) . "', date_modified = NOW()  WHERE review_id = '" . (int)$review_id . "'");
            else if ($data == "text")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "review SET text = '" . $this->db->escape(strip_tags($value)) . "', date_modified = NOW()  WHERE review_id = '" . (int)$review_id . "'");
            else if ($data == "rating") {
                $rating = (int)$value < 1 ? 1 : (int)$value > 5 ? 5 : (int)$value;
                $result = $this->db->query("UPDATE " . DB_PREFIX . "review SET rating = '" . $rating . "', date_modified = NOW()  WHERE review_id = '" . (int)$review_id . "'");
            } else if ($data == "date_added") {
                $date = $value;
                $result = $this->db->query("UPDATE " . DB_PREFIX . "review SET date_added = '" . $date . "', date_modified = NOW()  WHERE review_id = '" . (int)$review_id . "'");
            }
        }

        $this->cache->delete('product');

        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $sql = "SELECT r.review_id, pd.name, r.author, r.rating, r.status, r.date_added FROM " . DB_PREFIX . "review r LEFT JOIN " . DB_PREFIX . "product_description pd ON (r.product_id = pd.product_id) WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "'";
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) {
            $sql = "SELECT r.review_id, pd.name, r.author, r.text, r.rating, r.status, r.date_added FROM " . DB_PREFIX . "review r LEFT JOIN " . DB_PREFIX . "product_description pd ON (r.product_id = pd.product_id) WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "'";
        } else {
            $sql = "SELECT r.review_id, pd.name, r.author, r.rating, r.status, r.date_added FROM " . DB_PREFIX . "review r LEFT JOIN " . DB_PREFIX . "product_description pd ON (r.product_id = pd.product_id) WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "'";
        }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/review_list.tpl">
        <operation>
            <search position="replace" offset="24"><![CDATA[
            <td class="left"><?php if ($sort == 'pd.name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'product': ?>
              <td class="left"><?php if ($sort == 'pd.name') { ?>
                <a href="<?php echo $sort_product; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_product; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_product; ?>"><?php echo $column_product; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'author': ?>
              <td class="left"><?php if ($sort == 'r.author') { ?>
                <a href="<?php echo $sort_author; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_author; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_author; ?>"><?php echo $column_author; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'text': ?>
              <td class="left"><?php echo $column_text; ?></td>
                        <?php break;
                    case 'rating': ?>
              <td class="right"><?php if ($sort == 'r.rating') { ?>
                <a href="<?php echo $sort_rating; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_rating; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_rating; ?>"><?php echo $column_rating; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left"><?php if ($sort == 'r.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'date_added': ?>
              <td class="left"><?php if ($sort == 'r.date_added') { ?>
                <a href="<?php echo $sort_date_added; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_added; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_added; ?>"><?php echo $column_date_added; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'pd.name') { ?>
                <a href="<?php echo $sort_product; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_product; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_product; ?>"><?php echo $column_product; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'r.author') { ?>
                <a href="<?php echo $sort_author; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_author; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_author; ?>"><?php echo $column_author; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'r.rating') { ?>
                <a href="<?php echo $sort_rating; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_rating; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_rating; ?>"><?php echo $column_rating; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'r.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'r.date_added') { ?>
                <a href="<?php echo $sort_date_added; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_added; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_added; ?>"><?php echo $column_date_added; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="4"><![CDATA[
            <td class="left"><?php echo $review['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'product': ?>
              <td class="left product<?php echo ($column_info[$col]['qe_status']) ? ' product_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $review['review_id']; ?>"><?php echo $review['product']; ?></td>
                        <?php break;
                    case 'author': ?>
              <td class="left author<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $review['review_id']; ?>"><?php echo $review['author']; ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left status<?php echo ($column_info[$col]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $review['review_id']; ?>"><?php echo $review['status']; ?></td>
                        <?php break;
                    case 'text': ?>
              <td class="left text<?php echo ($column_info[$col]['qe_status']) ? ' text_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $review['review_id']; ?>"><?php echo $review['text']; ?></td>
                        <?php break;
                    case 'rating': ?>
              <td class="right rating<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $review['review_id']; ?>"><?php echo $review['rating']; ?></td>
                        <?php break;
                    case 'date_added': ?>
              <td class="left date_added<?php echo ($column_info[$col]['qe_status']) ? ' date_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $review['review_id']; ?>"><?php echo $review['date_added']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $review['name']; ?></td>
              <td class="left"><?php echo $review['author']; ?></td>
              <td class="right"><?php echo $review['rating']; ?></td>
              <td class="left"><?php echo $review['status']; ?></td>
              <td class="left"><?php echo $review['date_added']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="7"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="7"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_reviews_status')) { ?>
<script type="text/javascript" src="view/javascript/jquery/ui/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

 $(".status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".product_quick_edit").editable(function(value, settings) {
    var product = $('#product_edit', this);
    var product_id = product.attr('title');
    if (!product_id || product.val() == '')
        return this.revert;
    value = product_id;
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      type      : 'product_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      select    : true,
      token     : '<?php echo $token; ?>',
  });
 $(".date_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      type      : 'date_time_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "ignore",
  });
 $(".text_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      type      : 'textarea',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      submit    : 'OK',
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> DOWNLOADS -->
    <file name="admin/controller/catalog/download.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogDownload extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            $this->data['downloads'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_downloads'));
                $columns = array(
                    'download_id' => $result['download_id'],
                    'selected'    => isset($this->request->post['selected']) && in_array($result['download_id'], $this->request->post['selected']),
                    'action'      => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            $columns[$column] = $result[$column];
                        }
                    }
                }
                $this->data['downloads'][] = $columns;
            } else {
                $this->data['downloads'][] = array(
                    'download_id' => $result['download_id'],
                    'name'        => $result['name'],
                    'remaining'   => $result['remaining'],
                    'selected'    => isset($this->request->post['selected']) && in_array($result['download_id'], $this->request->post['selected']),
                    'action'      => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_name'] = $this->language->get('column_name');
            ]]></search>
            <add><![CDATA[
        $this->data['column_mask'] = $this->language->get('column_mask');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_downloads'));
            if (!is_array($cols)) {
                $column_order = array('name', 'remaining');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/download/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('catalog/download/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['sort_name'] = $this->url->link('catalog/download'
            ]]></search>
            <add><![CDATA[
        $this->data['sort_mask'] = $this->url->link('catalog/download', 'token=' . $this->session->data['token'] . '&sort=d.mask' . $url, 'SSL');
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/download');
            $result = $this->model_catalog_download->getDownloadDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['name']);
            }
        } else {
            $this->language->load('catalog/download');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/download');
        $this->load->model('catalog/download');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "name") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_download->quickEditDownload($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('remaining')))
                    $json['value'] = (int)$value;
                else if($column == 'name') {
                    if ($lang_id == $this->config->get('config_language_id'))
                        $json['value'] = $value;
                    else
                        $json['value'] = $this->request->post['old'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/download')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/download')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/download.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_mask']            = 'Filename';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_name']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/download.php">
        <operation>
            <search position="before"><![CDATA[
            public function addDownload($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditDownload($download_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'remaining');
        $result = false;
        if (in_array($data, $editable)) {
            if ($data == "remaining")
                $result = $this->db->query("UPDATE `" . DB_PREFIX . "download` SET " . $data . " = '" . (int)$value . "' WHERE download_id = '" . (int)$download_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "download_description SET name = '" . $this->db->escape($value) . "' WHERE download_id = '" . (int)$download_id . "' AND language_id = '" . (int)$lang_id . "'");
        }
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (isset($data['sort']) && in_array($data['sort'], $sort_data))
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) {
            $sort_data[] = "d.mask";
        }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/download_list.tpl">
        <operation>
            <search position="replace" offset="9"><![CDATA[
            <td class="left"><?php if ($sort == 'dd.name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'dd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'mask': ?>
              <td class="left"><?php if ($sort == 'd.mask') { ?>
                <a href="<?php echo $sort_mask; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_mask; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_mask; ?>"><?php echo $column_mask; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'remaining': ?>
              <td class="right"><?php if ($sort == 'd.remaining') { ?>
                <a href="<?php echo $sort_remaining; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_remaining; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_remaining; ?>"><?php echo $column_remaining; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'dd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'd.remaining') { ?>
                <a href="<?php echo $sort_remaining; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_remaining; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_remaining; ?>"><?php echo $column_remaining; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $download['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $download['download_id']; ?>"><?php echo $download['name']; ?></td>
                        <?php break;
                    case 'mask': ?>
              <td class="left mask<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $download['download_id']; ?>"><?php echo $download['mask']; ?></td>
                        <?php break;
                    case 'remaining': ?>
              <td class="right remaining<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $download['download_id']; ?>"><?php echo $download['remaining']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $download['name']; ?></td>
              <td class="right"><?php echo $download['remaining']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="6"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_downloads_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
<?php if ($single_lang_editing) { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> MANUFACTURERS -->
    <file name="admin/controller/catalog/manufacturer.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogManufacturer extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            $this->data['manufacturers'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_manufacturers'));
                $columns = array(
                    'manufacturer_id' => $result['manufacturer_id'],
                    'selected'        => isset($this->request->post['selected']) && in_array($result['manufacturer_id'], $this->request->post['selected']),
                    'action'          => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            if ($column == 'image') {
                                $this->load->model('tool/image');
                                if ($result['image'] && file_exists(DIR_IMAGE . $result['image'])) {
                                    $image = $this->model_tool_image->resize($result['image'], 40, 40);
                                } else {
                                    $image = $this->model_tool_image->resize('no_image.jpg', 40, 40);
                                }
                                $columns[$column] = $image;
                            } else {
                                $columns[$column] = isset($result[$column]) ? $result[$column] : '';
                            }
                        }
                    }
                }
                $this->data['manufacturers'][] = $columns;
            } else {
                $this->data['manufacturers'][] = array(
                    'manufacturer_id' => $result['manufacturer_id'],
                    'name'            => $result['name'],
                    'sort_order'      => $result['sort_order'],
                    'selected'        => isset($this->request->post['selected']) && in_array($result['manufacturer_id'], $this->request->post['selected']),
                    'action'          => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_name'] = $this->language->get('column_name');
            ]]></search>
            <add><![CDATA[
        $this->data['column_image'] = $this->language->get('column_image');
        $this->data['column_seo'] = $this->language->get('column_seo');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_manufacturers'));
            if (!is_array($cols)) {
                $column_order = array('name', 'sort_order');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/manufacturer/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['sort_name'] = $this->url->link('catalog/manufacturer'
            ]]></search>
            <add><![CDATA[
        $this->data['sort_seo'] = $this->url->link('catalog/manufacturer', 'token=' . $this->session->data['token'] . '&sort=seo' . $url, 'SSL');
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function quick_update() {
        $this->language->load('catalog/manufacturer');
        $this->load->model('catalog/manufacturer');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            $result = $this->model_catalog_manufacturer->quickEditManufacturer($id, $column, $value);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('seo', 'name')))
                    $json['value'] = $value;
                else if (in_array($column, array('sort_order')))
                    $json['value'] = (int)$value;
                else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }

        $this->response->setOutput(json_encode($json));
    }

    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/category')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/manufacturer.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_seo']             = 'SEO Keyword';
$_['column_image']           = 'Image';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_name']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/manufacturer.php">
        <operation>
            <search position="before"><![CDATA[
            public function addManufacturer($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditManufacturer($manufacturer_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'sort_order');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('sort_order')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "manufacturer SET `" . $data . "` = '" . (int)$value . "' WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "manufacturer SET name = '" . $this->db->escape($value) . "' WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
        } else if ($data == 'seo') {
            $this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'manufacturer_id=" . (int)$manufacturer_id. "'");
            if (!empty($value))
                $result = $this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'manufacturer_id=" . (int)$manufacturer_id . "', keyword = '" . $this->db->escape($value) . "'");
            else
                $result = 1;
        }
        $this->cache->delete('manufacturer');
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $sql = "SELECT * FROM " . DB_PREFIX . "manufacturer";
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) {
			//Paladin  AND language_id = '" . (int)$this->config->get('config_language_id') . "'
            $sql = "SELECT *, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('manufacturer_id=', manufacturer_id) AND language_id = '" . (int)$this->config->get('config_language_id') . "') AS seo FROM " . DB_PREFIX . "manufacturer";
        } else {
            $sql = "SELECT * FROM " . DB_PREFIX . "manufacturer";
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (isset($data['sort']) && in_array($data['sort'], $sort_data))
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) {
            $sort_data[] = "seo";
        }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "manufacturer ORDER BY name");
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) {
			//Paladin  AND language_id = '" . (int)$this->config->get('config_language_id') . "'
            $query = $this->db->query("SELECT *, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('manufacturer_id=', manufacturer_id) AND language_id = '" . (int)$this->config->get('config_language_id') . "') AS seo FROM " . DB_PREFIX . "manufacturer ORDER BY name");
        } else {
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "manufacturer ORDER BY name");
        }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/manufacturer_list.tpl">
        <operation>
            <search position="replace" offset="9"><![CDATA[
            <td class="left"><?php if ($sort == 'name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td class="center"><?php echo $column_image; ?></td>
                        <?php break;
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php if ($sort == 'sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left"><?php if ($sort == 'seo') { ?>
                <a href="<?php echo $sort_seo; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_seo; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_seo; ?>"><?php echo $column_seo; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $manufacturer['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td class="center"><img src="<?php echo $manufacturer['image']; ?>" alt="<?php echo $manufacturer['name']; ?>" style="padding: 1px; border: 1px solid #DDDDDD;" /></td>
                        <?php break;
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $manufacturer['manufacturer_id']; ?>"><?php echo $manufacturer['name']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $manufacturer['manufacturer_id']; ?>"><?php echo $manufacturer['sort_order']; ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left seo<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $manufacturer['manufacturer_id']; ?>"><?php echo $manufacturer['seo']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $manufacturer['name']; ?></td>
              <td class="right"><?php echo $manufacturer['sort_order']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_manufacturers_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> OPTIONS -->
    <file name="admin/controller/catalog/option.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogOption extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            $this->data['options'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_options_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_options'));
                $columns = array(
                    'option_id'  => $result['option_id'],
                    'selected'   => isset($this->request->post['selected']) && in_array($result['option_id'], $this->request->post['selected']),
                    'action'     => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            $columns[$column] = $result[$column];
                        }
                    }
                }
                $this->data['options'][] = $columns;
            } else {
                $this->data['options'][] = array(
                    'option_id'  => $result['option_id'],
                    'name'       => $result['name'],
                    'sort_order' => $result['sort_order'],
                    'selected'   => isset($this->request->post['selected']) && in_array($result['option_id'], $this->request->post['selected']),
                    'action'     => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_options_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_options'));
            if (!is_array($cols)) {
                $column_order = array('name', 'sort_order');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/option/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('catalog/option/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/option');
            $result = $this->model_catalog_option->getOptionDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['name']);
            }
        } else {
            $this->language->load('catalog/option');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/option');
        $this->load->model('catalog/option');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "name") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_option->quickEditOption($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('sort_order')))
                    $json['value'] = (int)$value;
                else if($column == 'name') {
                    if ($lang_id == $this->config->get('config_language_id'))
                        $json['value'] = $value;
                    else
                        $json['value'] = $this->request->post['old'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/option')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/option')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/option.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_name']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/option.php">
        <operation>
            <search position="before"><![CDATA[
            public function addOption($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditOption($option_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'sort_order');
        $result = false;
        if (in_array($data, $editable)) {
            if ($data == "sort_order")
                $result = $this->db->query("UPDATE `" . DB_PREFIX . "option` SET " . $data . " = '" . (int)$value . "' WHERE option_id = '" . (int)$option_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "option_description SET name = '" . $this->db->escape($value) . "' WHERE option_id = '" . (int)$option_id . "' AND language_id = '" . (int)$lang_id . "'");
        }
        return $result;
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/option_list.tpl">
        <operation>
            <search position="replace" offset="9"><![CDATA[
            <td class="left"><?php if ($sort == 'od.name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_options_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'od.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php if ($sort == 'o.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'od.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'o.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $option['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_options_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $option['option_id']; ?>"><?php echo $option['name']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $option['option_id']; ?>"><?php echo $option['sort_order']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $option['name']; ?></td>
              <td class="right"><?php echo $option['sort_order']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="5"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_options_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_options_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
<?php if ($single_lang_editing) { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> ATTRIBUTE GROUPS -->
    <file name="admin/controller/catalog/attribute_group.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogAttributeGroup extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            $this->data['attribute_groups'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attribute_groups_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_attribute_groups'));
                $columns = array(
                    'attribute_group_id' => $result['attribute_group_id'],
                    'selected'           => isset($this->request->post['selected']) && in_array($result['attribute_group_id'], $this->request->post['selected']),
                    'action'             => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            $columns[$column] = $result[$column];
                        }
                    }
                }
                $this->data['attribute_groups'][] = $columns;
            } else {
                $this->data['attribute_groups'][] = array(
                    'attribute_group_id' => $result['attribute_group_id'],
                    'name'               => $result['name'],
                    'sort_order'         => $result['sort_order'],
                    'selected'           => isset($this->request->post['selected']) && in_array($result['attribute_group_id'], $this->request->post['selected']),
                    'action'             => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attribute_groups_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_attribute_groups'));
            if (!is_array($cols)) {
                $column_order = array('name', 'sort_order');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/attribute_group/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('catalog/attribute_group/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/attribute_group');
            $result = $this->model_catalog_attribute_group->getAttributeGroupDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['name']);
            }
        } else {
            $this->language->load('catalog/attribute_group');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/attribute_group');
        $this->load->model('catalog/attribute_group');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "name") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_attribute_group->quickEditAttributeGroup($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('sort_order')))
                    $json['value'] = (int)$value;
                else if($column == 'name') {
                    if ($lang_id == $this->config->get('config_language_id'))
                        $json['value'] = $value;
                    else
                        $json['value'] = $this->request->post['old'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/attribute_group')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/attribute_group')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/attribute_group.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_name']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/attribute_group.php">
        <operation>
            <search position="before"><![CDATA[
            public function addAttributeGroup($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditAttributeGroup($attribute_group_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'sort_order');
        $result = false;
        if (in_array($data, $editable)) {
            if ($data == "sort_order")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "attribute_group SET " . $data . " = '" . (int)$value . "' WHERE attribute_group_id = '" . (int)$attribute_group_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "attribute_group_description SET name = '" . $this->db->escape($value) . "' WHERE attribute_group_id = '" . (int)$attribute_group_id . "' AND language_id = '" . (int)$lang_id . "'");
        }
        return $result;
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/attribute_group_list.tpl">
        <operation>
            <search position="replace" offset="9"><![CDATA[
            <td class="left"><?php if ($sort == 'agd.name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attribute_groups_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'agd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php if ($sort == 'ag.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'agd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'ag.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $attribute_group['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attribute_groups_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $attribute_group['attribute_group_id']; ?>"><?php echo $attribute_group['name']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $attribute_group['attribute_group_id']; ?>"><?php echo $attribute_group['sort_order']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $attribute_group['name']; ?></td>
              <td class="right"><?php echo $attribute_group['sort_order']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attribute_groups_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attribute_groups_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
<?php if ($single_lang_editing) { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> ATTRIBUTES -->
    <file name="admin/controller/catalog/attribute.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogAttribute extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="7"><![CDATA[
            $this->data['attributes'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attributes_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_attributes'));
                $columns = array(
                    'attribute_id'    => $result['attribute_id'],
                    'selected'        => isset($this->request->post['selected']) && in_array($result['attribute_id'], $this->request->post['selected']),
                    'action'          => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['attribute_group'] = $result['attribute_group'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            $columns[$column] = $result[$column];
                        }
                    }
                }
                $this->data['attributes'][] = $columns;
            } else {
                $this->data['attributes'][] = array(
                    'attribute_id'    => $result['attribute_id'],
                    'name'            => $result['name'],
                    'attribute_group' => $result['attribute_group'],
                    'sort_order'      => $result['sort_order'],
                    'selected'        => isset($this->request->post['selected']) && in_array($result['attribute_id'], $this->request->post['selected']),
                    'action'          => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attributes_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_attributes'));
            if (!is_array($cols)) {
                $column_order = array('name', 'attribute_group', 'sort_order');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/attribute/quick_update', 'token=' . $this->session->data['token'], 'SSL'));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('catalog/attribute/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);

            $this->load->model('catalog/attribute_group');
            $attribute_groups = $this->model_catalog_attribute_group->getAttributeGroups();
            $ag_select = array();
            foreach ($attribute_groups as $ag) {
                $ag_select[$ag['attribute_group_id']] = $ag['name'];
            }
            $this->data['attribute_group_select'] = addslashes(json_encode($ag_select));
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/attribute');
            $result = $this->model_catalog_attribute->getAttributeDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['name']);
            }
        } else {
            $this->language->load('catalog/attribute');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/attribute');
        $this->load->model('catalog/attribute');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "name") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_attribute->quickEditAttribute($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('sort_order')))
                    $json['value'] = (int)$value;
                else if ($column == 'attribute_group') {
                    $this->load->model('catalog/attribute_group');
                    $attribute_group = $this->model_catalog_attribute_group->getAttributeGroupDescriptions((int)$value);
                    $lang_id = $this->config->get('config_language_id');
                    if ($attribute_group)
                        $json['value'] = $attribute_group[$lang_id]['name'];
                    else
                        $json['value'] = '';
                } else if($column == 'name') {
                    if ($lang_id == $this->config->get('config_language_id'))
                        $json['value'] = $value;
                    else
                        $json['value'] = $this->request->post['old'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/attribute')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/attribute')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/attribute.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_name']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/attribute.php">
        <operation>
            <search position="before"><![CDATA[
            public function addAttribute($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditAttribute($attribute_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'attribute_group', 'sort_order');
        $result = false;
        if (in_array($data, $editable)) {
            if ($data == "sort_order")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "attribute SET " . $data . " = '" . (int)$value . "' WHERE attribute_id = '" . (int)$attribute_id . "'");
            else if ($data == "attribute_group")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "attribute SET attribute_group_id = '" . (int)$value . "' WHERE attribute_id = '" . (int)$attribute_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "attribute_description SET name = '" . $this->db->escape($value) . "' WHERE attribute_id = '" . (int)$attribute_id . "' AND language_id = '" . (int)$lang_id . "'");
        }
        return $result;
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/attribute_list.tpl">
        <operation>
            <search position="replace" offset="14"><![CDATA[
            <td class="left"><?php if ($sort == 'ad.name') { ?>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attributes_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'ad.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'attribute_group': ?>
              <td class="left"><?php if ($sort == 'attribute_group') { ?>
                <a href="<?php echo $sort_attribute_group; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_attribute_group; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_attribute_group; ?>"><?php echo $column_attribute_group; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php if ($sort == 'a.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php if ($sort == 'ad.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'attribute_group') { ?>
                <a href="<?php echo $sort_attribute_group; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_attribute_group; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_attribute_group; ?>"><?php echo $column_attribute_group; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'a.sort_order') { ?>
                <a href="<?php echo $sort_sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="2"><![CDATA[
            <td class="left"><?php echo $attribute['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attributes_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $attribute['attribute_id']; ?>"><?php echo $attribute['name']; ?></td>
                        <?php break;
                    case 'attribute_group': ?>
              <td class="left attribute_group<?php echo ($column_info[$col]['qe_status']) ? ' attribute_group_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $attribute['attribute_id']; ?>"><?php echo $attribute['attribute_group']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $attribute['attribute_id']; ?>"><?php echo $attribute['sort_order']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $attribute['name']; ?></td>
              <td class="left"><?php echo $attribute['attribute_group']; ?></td>
              <td class="right"><?php echo $attribute['sort_order']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="5"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attributes_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="5"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_attributes_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

 $(".attribute_group_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($attribute_group_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
<?php if ($single_lang_editing) { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> CATEGORIES -->
    <file name="admin/controller/catalog/category.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogCategory extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="6"><![CDATA[
            $this->data['categories'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) {
                $cols = @unserialize($this->config->get('aqe_catalog_categories'));
                $columns = array(
                    'category_id' => $result['category_id'],
                    'selected'    => isset($this->request->post['selected']) && in_array($result['category_id'], $this->request->post['selected']),
                    'action'      => $action
                );
                if (!is_array($cols)) {
                    $columns['name'] = $result['name'];
                    $columns['sort_order'] = $result['sort_order'];
                } else {
                    foreach($cols as $column => $attr) {
                        if ($attr['display']) {
                            if ($column == 'image') {
                                $this->load->model('tool/image');
                                if ($result['image'] && file_exists(DIR_IMAGE . $result['image'])) {
                                    $image = $this->model_tool_image->resize($result['image'], 40, 40);
                                } else {
                                    $image = $this->model_tool_image->resize('no_image.jpg', 40, 40);
                                }
                                $columns[$column] = $image;
                            } else if ($column == 'top') {
                                $columns[$column] = ($result['top'] ? $this->language->get('text_yes') : $this->language->get('text_no'));
                            } else if ($column == 'status') {
                                $columns[$column] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                            } else {
                                $columns[$column] = $result[$column];
                            }
                        }
                    }
                }
                $this->data['categories'][] = $columns;
            } else {
                $this->data['categories'][] = array(
                    'category_id' => $result['category_id'],
                    'name'        => $result['name'],
                    'sort_order'  => $result['sort_order'],
                    'selected'    => isset($this->request->post['selected']) && in_array($result['category_id'], $this->request->post['selected']),
                    'action'      => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_name'] = $this->language->get('column_name');
            ]]></search>
            <add><![CDATA[
        $this->data['column_image'] = $this->language->get('column_image');
        $this->data['column_seo'] = $this->language->get('column_seo');
        $this->data['column_column'] = $this->language->get('column_column');
        $this->data['column_top'] = $this->language->get('column_top');
        $this->data['column_status'] = $this->language->get('column_status');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_delete'] = $this->language->get('button_delete');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) {
            $cols = @unserialize($this->config->get('aqe_catalog_categories'));
            if (!is_array($cols)) {
                $column_order = array('name', 'sort_order');
                $cols = array();
            } else {
                $column_order = array();
                uasort($cols, 'column_sort');

                foreach($cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/category/quick_update', 'token=' . $this->session->data['token'], 'SSL'));
            $this->data['status_select'] = addslashes(json_encode(array("0" => $this->language->get('text_disabled'), "1" => $this->language->get('text_enabled'))));
            $this->data['top_select'] = addslashes(json_encode(array("0" => $this->language->get('text_no'), "1" => $this->language->get('text_yes'))));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('catalog/category/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);

            $this->load->model('catalog/category');
            $this->data['cats'] = $this->model_catalog_category->getCategories(0);
            $c_select = array();
            foreach ($this->data['cats'] as $c) {
                $c_select[$c['category_id']] = $c['name'];
            }
            $this->data['category_select'] = addslashes(json_encode($c_select));
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/category');
            $result = $this->model_catalog_category->getCategoryDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['name']);
            }
        } else {
            $this->language->load('catalog/category');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/category');
        $this->load->model('catalog/category');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "name") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_category->quickEditCategory($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('seo')))
                    $json['value'] = $value;
                else if (in_array($column, array('sort_order', 'column')))
                    $json['value'] = (int)$value;
                else if ($column == 'status')
                    $json['value'] = ((int)$value) ? $this->language->get('text_enabled') : $this->language->get('text_disabled');
                else if ($column == 'top')
                    $json['value'] = ((int)$value) ? $this->language->get('text_yes') : $this->language->get('text_no');
                else if($column == 'name') {
                    if ($lang_id == $this->config->get('config_language_id')) {
                        $this->load->model('catalog/category');
                        $json['value'] = $this->model_catalog_category->getPath($id);
                    } else
                        $json['value'] = $this->request->post['old'];
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/category')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/category')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "name" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/category.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_seo']             = 'SEO Keyword';
$_['column_image']           = 'Image';
$_['column_column']          = 'Columns';
$_['column_top']             = 'Top';
$_['column_status']          = 'Status';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_name']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/category.php">
        <operation>
            <search position="before"><![CDATA[
            public function addCategory($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditCategory($category_id, $data, $value, $lang_id=null) {
        $editable = array('name', 'column', 'top', 'status', 'sort_order');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('column', 'top', 'sort_order', 'status')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "category SET `" . $data . "` = '" . (int)$value . "', date_modified = NOW() WHERE category_id = '" . (int)$category_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "category_description SET name = '" . $this->db->escape($value) . "' WHERE category_id = '" . (int)$category_id . "' AND language_id = '" . (int)$lang_id . "'");
        } else if ($data == 'seo') {
            $this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id. "'");
            if (!empty($value))
                $result = $this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'category_id=" . (int)$category_id . "', keyword = '" . $this->db->escape($value) . "'");
            else
                $result = 1;
        }
        $this->cache->delete('category');
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) WHERE c.parent_id = '" . (int)$parent_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY c.sort_order, cd.name ASC");
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) {
			//Paladin  AND language_id = '" . (int)$this->config->get('config_language_id') . "'
            $query = $this->db->query("SELECT c.*, cd.*, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('category_id=', c.category_id) AND language_id = '" . (int)$this->config->get('config_language_id') . "') AS seo FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) WHERE c.parent_id = '" . (int)$parent_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY c.sort_order, cd.name ASC");
        } else {
            $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) WHERE c.parent_id = '" . (int)$parent_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY c.sort_order, cd.name ASC");
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            'category_id' => $result['category_id'],
            ]]></search>
            <add><![CDATA[
                    'image'       => isset($result['image']) ? $result['image'] : '',
                    'top'         => isset($result['top']) ? $result['top'] : '',
                    'column'      => isset($result['column']) ? $result['column'] : '',
                    'seo'         => isset($result['seo']) ? $result['seo']: '',
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/category_list.tpl">
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $column_name; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td class="center"><?php echo $column_image; ?></td>
                        <?php break;
                    case 'name': ?>
              <td class="left"><?php echo $column_name; ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left"><?php echo $column_status; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php echo $column_sort_order; ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left"><?php echo $column_seo; ?></td>
                        <?php break;
                    case 'top': ?>
              <td class="left"><?php echo $column_top; ?></td>
                        <?php break;
                    case 'column': ?>
              <td class="left"><?php echo $column_column; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $column_name; ?></td>
              <td class="right"><?php echo $column_sort_order; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="1"><![CDATA[
            <td class="left"><?php echo $category['name']; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td class="center"><img src="<?php echo $category['image']; ?>" alt="<?php echo $category['name']; ?>" style="padding: 1px; border: 1px solid #DDDDDD;" /></td>
                        <?php break;
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $category['category_id']; ?>"><?php echo $category['name']; ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left status<?php echo ($column_info[$col]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $category['category_id']; ?>"><?php echo $category['status']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $category['category_id']; ?>"><?php echo $category['sort_order']; ?></td>
                        <?php break;
                    case 'top': ?>
              <td class="left top<?php echo ($column_info[$col]['qe_status']) ? ' top_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $category['category_id']; ?>"><?php echo $category['top']; ?></td>
                        <?php break;
                    case 'column': ?>
              <td class="left column<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $category['category_id']; ?>"><?php echo $category['column']; ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left seo<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $category['category_id']; ?>"><?php echo $category['seo']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="left"><?php echo $category['name']; ?></td>
              <td class="right"><?php echo $category['sort_order']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="4"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_categories_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

 $(".status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
 $(".top_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($top_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
<?php if ($single_lang_editing) { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
 $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
});
//--></script> 
<?php } ?>
            ]]></add>
        </operation>
    </file>


<!-- CATALOG -> PRODUCTS -->
    <file name="admin/controller/catalog/product.php">
        <operation>
            <search position="before"><![CDATA[
            class ControllerCatalogProduct extends Controller
            ]]></search>
            <add><![CDATA[
function column_sort($a, $b) {
    if ($a['index'] == $b['index']) {
        return 0;
    }
    return ($a['index'] < $b['index']) ? -1 : 1;
}
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            private function getList()
            ]]></search>
            <add><![CDATA[
//        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            if (isset($this->request->get['filter_tax_class'])) {
                $filter_tax_class = $this->request->get['filter_tax_class'];
            } else {
                $filter_tax_class = null;
            }

            if (isset($this->request->get['filter_minimum'])) {
                $filter_minimum = $this->request->get['filter_minimum'];
            } else {
                $filter_minimum = null;
            }

            if (isset($this->request->get['filter_subtract'])) {
                $filter_subtract = $this->request->get['filter_subtract'];
            } else {
                $filter_subtract = null;
            }

            if (isset($this->request->get['filter_stock_status'])) {
                $filter_stock_status = $this->request->get['filter_stock_status'];
            } else {
                $filter_stock_status = null;
            }

            if (isset($this->request->get['filter_shipping'])) {
                $filter_shipping = $this->request->get['filter_shipping'];
            } else {
                $filter_shipping = null;
            }

            if (isset($this->request->get['filter_date_available'])) {
                $filter_date_available = $this->request->get['filter_date_available'];
            } else {
                $filter_date_available = null;
            }

            if (isset($this->request->get['filter_length'])) {
                $filter_length = $this->request->get['filter_length'];
            } else {
                $filter_length = null;
            }

            if (isset($this->request->get['filter_width'])) {
                $filter_width = $this->request->get['filter_width'];
            } else {
                $filter_width = null;
            }

            if (isset($this->request->get['filter_height'])) {
                $filter_height = $this->request->get['filter_height'];
            } else {
                $filter_height = null;
            }

            if (isset($this->request->get['filter_length_class'])) {
                $filter_length_class = $this->request->get['filter_length_class'];
            } else {
                $filter_length_class = null;
            }

            if (isset($this->request->get['filter_weight_class'])) {
                $filter_weight_class = $this->request->get['filter_weight_class'];
            } else {
                $filter_weight_class = null;
            }

            if (isset($this->request->get['filter_points'])) {
                $filter_points = $this->request->get['filter_points'];
            } else {
                $filter_points = null;
            }

            if (isset($this->request->get['filter_order'])) {
                $filter_order = $this->request->get['filter_order'];
            } else {
                $filter_order = null;
            }

            if (isset($this->request->get['filter_upc'])) {
                $filter_upc = $this->request->get['filter_upc'];
            } else {
                $filter_upc = null;
            }

            if (isset($this->request->get['filter_manufacturer'])) {
                $filter_manufacturer = $this->request->get['filter_manufacturer'];
            } else {
                $filter_manufacturer = null;
            }

            if (isset($this->request->get['filter_sku'])) {
                $filter_sku = $this->request->get['filter_sku'];
            } else {
                $filter_sku = null;
            }

            if (isset($this->request->get['filter_location'])) {
                $filter_location = $this->request->get['filter_location'];
            } else {
                $filter_location = null;
            }

            if (isset($this->request->get['filter_seo'])) {
                $filter_seo = $this->request->get['filter_seo'];
            } else {
                $filter_seo = null;
            }

            if (isset($this->request->get['filter_weight'])) {
                $filter_weight = $this->request->get['filter_weight'];
            } else {
                $filter_weight = null;
            }

            if (isset($this->request->get['filter_category_id'])) {
                $filter_category_id = $this->request->get['filter_category_id'];
            } else {
                $filter_category_id = '';
            }
            
            if (isset($this->request->get['filter_sub_category'])) {
                $filter_sub_category = $this->request->get['filter_sub_category'];
            } else {
                $filter_sub_category = $this->config->get('aqe_catalog_products_filter_sub_category');
            }
//        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            $url .= '&filter_name=' . $this->request->get['filter_name'];
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            if (isset($this->request->get['filter_tax_class'])) {
                $url .= '&filter_tax_class=' . $this->request->get['filter_tax_class'];
            }

            if (isset($this->request->get['filter_minimum'])) {
                $url .= '&filter_minimum=' . $this->request->get['filter_minimum'];
            }

            if (isset($this->request->get['filter_subtract'])) {
                $url .= '&filter_subtract=' . $this->request->get['filter_subtract'];
            }

            if (isset($this->request->get['filter_stock_status'])) {
                $url .= '&filter_stock_status=' . $this->request->get['filter_stock_status'];
            }

            if (isset($this->request->get['filter_shipping'])) {
                $url .= '&filter_shipping=' . $this->request->get['filter_shipping'];
            }

            if (isset($this->request->get['filter_date_available'])) {
                $url .= '&filter_date_available=' . $this->request->get['filter_date_available'];
            }

            if (isset($this->request->get['filter_length'])) {
                $url .= '&filter_length=' . $this->request->get['filter_length'];
            }

            if (isset($this->request->get['filter_width'])) {
                $url .= '&filter_width=' . $this->request->get['filter_width'];
            }

            if (isset($this->request->get['filter_height'])) {
                $url .= '&filter_height=' . $this->request->get['filter_height'];
            }

            if (isset($this->request->get['filter_length_class'])) {
                $url .= '&filter_length_class=' . $this->request->get['filter_length_class'];
            }

            if (isset($this->request->get['filter_weight_class'])) {
                $url .= '&filter_weight_class=' . $this->request->get['filter_weight_class'];
            }

            if (isset($this->request->get['filter_points'])) {
                $url .= '&filter_points=' . $this->request->get['filter_points'];
            }

            if (isset($this->request->get['filter_order'])) {
                $url .= '&filter_order=' . $this->request->get['filter_order'];
            }

            if (isset($this->request->get['filter_sku'])) {
                $url .= '&filter_sku=' . $this->request->get['filter_sku'];
            }

            if (isset($this->request->get['filter_upc'])) {
                $url .= '&filter_upc=' . $this->request->get['filter_upc'];
            }

            if (isset($this->request->get['filter_manufacturer'])) {
                $url .= '&filter_manufacturer=' . $this->request->get['filter_manufacturer'];
            }

            if (isset($this->request->get['filter_location'])) {
                $url .= '&filter_location=' . $this->request->get['filter_location'];
            }

            if (isset($this->request->get['filter_seo'])) {
                $url .= '&filter_seo=' . $this->request->get['filter_seo'];
            }

            if (isset($this->request->get['filter_weight'])) {
                $url .= '&filter_weight=' . $this->request->get['filter_weight'];
            }

            if (isset($this->request->get['filter_category_id'])) {
                $url .= '&filter_category_id=' . $this->request->get['filter_category_id'];
            }

            if (isset($this->request->get['filter_sub_category'])) {
                $url .= '&filter_sub_category=' . $this->request->get['filter_sub_category'];
            }
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before" index="1"><![CDATA[
            'filter_name'	  => $filter_name,
            ]]></search>
            <add><![CDATA[
            'filter_tax_class'      => $filter_tax_class,
            'filter_minimum'        => $filter_minimum,
            'filter_subtract'       => $filter_subtract,
            'filter_stock_status'   => $filter_stock_status,
            'filter_shipping'       => $filter_shipping,
            'filter_date_available' => $filter_date_available,
            'filter_length'         => $filter_length,
            'filter_width'          => $filter_width,
            'filter_height'         => $filter_height,
            'filter_length_class'   => $filter_length_class,
            'filter_weight_class'   => $filter_weight_class,
            'filter_points'         => $filter_points,
            'filter_order'          => $filter_order,
            'filter_sku'            => $filter_sku,
            'filter_upc'            => $filter_upc,
            'filter_manufacturer'   => $filter_manufacturer,
            'filter_location'       => $filter_location,
            'filter_seo'            => $filter_seo,
            'filter_weight'         => $filter_weight,
            'filter_category_id'    => $filter_category_id,
            'filter_sub_category'   => $filter_sub_category,
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="11"><![CDATA[
            $this->data['products'][] = array(
            ]]></search>
            <add><![CDATA[
            if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
                $cp_cols = @unserialize($this->config->get('aqe_catalog_products'));
                $columns = array(
                    'product_id' => $result['product_id'],
                    'selected'   => isset($this->request->post['selected']) && in_array($result['product_id'], $this->request->post['selected']),
                    'action'     => $action
                );
                if (!is_array($cp_cols)) {
                    $columns['name'] = $result['name'];
                    $columns['model'] = $result['model'];
                    $columns['price'] = $result['price'];
                    $columns['special'] = $special;
                    $columns['image'] = $result['image'];
                    $columns['status'] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                    $columns['quantity'] = $result['quantity'];
                } else {
                    foreach($cp_cols as $column => $attr) {
                        if ($attr['display']) {
                            if ($column == 'image')
                                $columns[$column] = $image;
                            else if ($column == 'category') {
                                $this->load->model('catalog/category');
                                $categories = $this->model_catalog_product->getProductCategories($result['product_id']);
                                $category_paths = array();
                                foreach($categories as $cat) {
                                    $category_paths[] = $this->model_catalog_category->getPath($cat);
                                }
                                $columns[$column] = implode("<br />", $category_paths);
                            } else if ($column == 'status') {
                                $columns[$column] = ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled'));
                            } else if ($column == 'requires_shipping') {
                                $columns['shipping'] = ($result['shipping'] ? $this->language->get('text_yes') : $this->language->get('text_no'));
                            } else if ($column == 'subtract') {
                                $columns[$column] = ($result['subtract'] ? $this->language->get('text_yes') : $this->language->get('text_no'));
                            } else if (in_array($column, array('weight', 'length', 'width', 'height'))) {
                                $columns[$column] = sprintf("%.4f",round((float)$result[$column], 4));
                            } else if ($column == 'date_available') {
                                $columns[$column] = date("Y-m-d", strtotime($result['date_available']));
                            } else {
                                $columns[$column] = $result[$column];
                                if ($column == 'price')
                                    $columns['special'] = $special;
                            }
                        }
                    }
                }
                $this->data['products'][] = $columns;
            } else {
                $this->data['products'][] = array(
                    'product_id' => $result['product_id'],
                    'name'       => $result['name'],
                    'model'      => $result['model'],
                    'price'      => $result['price'],
                    'special'    => $special,
                    'image'      => $image,
                    'quantity'   => $result['quantity'],
                    'status'     => ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled')),
                    'selected'   => isset($this->request->post['selected']) && in_array($result['product_id'], $this->request->post['selected']),
                    'action'     => $action
                );
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['column_image'] = $this->language->get('column_image');
            ]]></search>
            <add><![CDATA[
        $this->data['column_tax_class'] = $this->language->get('column_tax_class');
        $this->data['column_minimum'] = $this->language->get('column_minimum');
        $this->data['column_subtract'] = $this->language->get('column_subtract');
        $this->data['column_stock_status'] = $this->language->get('column_stock_status');
        $this->data['column_shipping'] = $this->language->get('column_shipping');
        $this->data['column_date_available'] = $this->language->get('column_date_available');
        $this->data['column_length'] = $this->language->get('column_length');
        $this->data['column_width'] = $this->language->get('column_width');
        $this->data['column_height'] = $this->language->get('column_height');
        $this->data['column_length_class'] = $this->language->get('column_length_class');
        $this->data['column_weight_class'] = $this->language->get('column_weight_class');
        $this->data['column_points'] = $this->language->get('column_points');
        $this->data['column_sort_order'] = $this->language->get('column_sort_order');
        $this->data['column_sku'] = $this->language->get('column_sku');
        $this->data['column_upc'] = $this->language->get('column_upc');
        $this->data['column_manufacturer'] = $this->language->get('column_manufacturer');
        $this->data['column_category'] = $this->language->get('column_category');
        $this->data['column_location'] = $this->language->get('column_location');
        $this->data['column_seo'] = $this->language->get('column_seo');
        $this->data['column_weight'] = $this->language->get('column_weight');
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $this->data['button_filter'] = $this->language->get('button_filter');
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            $cp_cols = @unserialize($this->config->get('aqe_catalog_products'));
            if (!is_array($cp_cols)) {
                $column_order = array('image', 'name', 'model', 'price', 'quantity', 'status');
                $cp_cols = array();
            } else {
                $column_order = array();
                uasort($cp_cols, 'column_sort');

                foreach($cp_cols as $column => $attr) {
                    if ($attr['display'])
                        $column_order[] = $column;
                }
            }
            $this->data['column_order'] = $column_order;
            $this->data['column_info'] = $cp_cols;
            $this->data['update_url'] = html_entity_decode($this->url->link('catalog/product/quick_update', 'token=' . $this->session->data['token'], 'SSL'));
            $this->data['status_select'] = addslashes(json_encode(array("0" => $this->language->get('text_disabled'), "1" => $this->language->get('text_enabled'))));
            $this->data['yes_no_select'] = addslashes(json_encode(array("0" => $this->language->get('text_no'), "1" => $this->language->get('text_yes'))));

            $this->data['text_saving'] = $this->language->get('text_saving');
            $this->data['text_loading'] = $this->language->get('text_loading');
            $this->data['text_none'] = $this->language->get('text_none');
            $this->data['text_yes'] = $this->language->get('text_yes');
            $this->data['text_no'] = $this->language->get('text_no');
            $this->data['text_click_edit'] = $this->language->get('text_click_edit');
            $this->data['error_update'] = $this->language->get('error_update');
            $this->data['language_id'] = $this->config->get('config_language_id');
            $this->data['load_name_url'] = html_entity_decode($this->url->link('catalog/product/load_name', 'token=' . $this->session->data['token'], 'SSL'));

            $this->load->model('localisation/language');
            $lang_count = $this->model_localisation_language->getTotalLanguages();
            $this->data['single_lang_editing'] = $this->config->get('aqe_single_language_editing') || ((int)$lang_count == 1);

            if (in_array("manufacturer", $column_order)) {
                $this->load->model('catalog/manufacturer');
                $this->data['manufacturers'] = $this->model_catalog_manufacturer->getManufacturers();
                $m_select = array();
                foreach ($this->data['manufacturers'] as $m) {
                    $m_select[$m['manufacturer_id']] = $m['name'];
                }
                $this->data['manufacturer_select'] = addslashes(json_encode($m_select));
            } else {
                $this->data['manufacturer_select'] = addslashes(json_encode(array()));
            }

            if (in_array("tax_class", $column_order)) {
                $this->load->model('localisation/tax_class');
                $this->data['tax_classes'] = $this->model_localisation_tax_class->getTaxClasses();
                $tc_select = array("0" => $this->language->get('text_none'));
                foreach ($this->data['tax_classes'] as $tc) {
                    $tc_select[$tc['tax_class_id']] = $tc['title'];
                }
                $this->data['tax_class_select'] = addslashes(json_encode($tc_select));
            } else {
                $this->data['tax_class_select'] = addslashes(json_encode(array()));
            }

            if (in_array("stock_status", $column_order)) {
                $this->load->model('localisation/stock_status');
                $this->data['stock_statuses'] = $this->model_localisation_stock_status->getStockStatuses();
                $ss_select = array();
                foreach ($this->data['stock_statuses'] as $ss) {
                    $ss_select[$ss['stock_status_id']] = $ss['name'];
                }
                $this->data['stock_status_select'] = addslashes(json_encode($ss_select));
            } else {
                $this->data['stock_status_select'] = addslashes(json_encode(array()));
            }

            if (in_array("length_class", $column_order)) {
                $this->load->model('localisation/length_class');
                $this->data['length_classes'] = $this->model_localisation_length_class->getLengthClasses();
                $lc_select = array();
                foreach ($this->data['length_classes'] as $lc) {
                    $lc_select[$lc['length_class_id']] = $lc['title'];
                }
                $this->data['length_class_select'] = addslashes(json_encode($lc_select));
            } else {
                $this->data['length_class_select'] = addslashes(json_encode(array()));
            }

            if (in_array("weight_class", $column_order)) {
                $this->load->model('localisation/weight_class');
                $this->data['weight_classes'] = $this->model_localisation_weight_class->getWeightClasses();
                $wc_select = array();
                foreach ($this->data['weight_classes'] as $wc) {
                    $wc_select[$wc['weight_class_id']] = $wc['title'];
                }
                $this->data['weight_class_select'] = addslashes(json_encode($wc_select));
            } else {
                $this->data['weight_class_select'] = addslashes(json_encode(array()));
            }

            if (in_array("category", $column_order)) {
                $this->load->model('catalog/category');
                $this->data['categories'] = $this->model_catalog_category->getCategories(0);
            }
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['sort_name'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=pd.name' . $url, 'SSL');
            ]]></search>
            <add><![CDATA[
        $this->data['sort_tax_class'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=tc.title' . $url, 'SSL');
        $this->data['sort_minimum'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.minimum' . $url, 'SSL');
        $this->data['sort_subtract'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.subtract' . $url, 'SSL');
        $this->data['sort_stock_status'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=ss.name' . $url, 'SSL');
        $this->data['sort_shipping'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.shipping' . $url, 'SSL');
        $this->data['sort_date_available'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.date_available' . $url, 'SSL');
        $this->data['sort_length'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.length' . $url, 'SSL');
        $this->data['sort_width'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.width' . $url, 'SSL');
        $this->data['sort_height'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.height' . $url, 'SSL');
        $this->data['sort_length_class'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=lc.title' . $url, 'SSL');
        $this->data['sort_weight_class'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=wc.title' . $url, 'SSL');
        $this->data['sort_points'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.points' . $url, 'SSL');
        $this->data['sort_sku'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.sku' . $url, 'SSL');
        $this->data['sort_upc'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.upc' . $url, 'SSL');
        $this->data['sort_manufacturer'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=m.name' . $url, 'SSL');
        $this->data['sort_location'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.location' . $url, 'SSL');
        $this->data['sort_seo'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=seo' . $url, 'SSL');
        $this->data['sort_weight'] = $this->url->link('catalog/product', 'token=' . $this->session->data['token'] . '&sort=p.weight' . $url, 'SSL');
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            $this->data['filter_name'] = $filter_name;
            ]]></search>
            <add><![CDATA[
        $this->data['filter_tax_class'] = $filter_tax_class;
        $this->data['filter_minimum'] = $filter_minimum;
        $this->data['filter_subtract'] = $filter_subtract;
        $this->data['filter_stock_status'] = $filter_stock_status;
        $this->data['filter_shipping'] = $filter_shipping;
        $this->data['filter_date_available'] = $filter_date_available;
        $this->data['filter_length'] = $filter_length;
        $this->data['filter_width'] = $filter_width;
        $this->data['filter_height'] = $filter_height;
        $this->data['filter_length_class'] = $filter_length_class;
        $this->data['filter_weight_class'] = $filter_weight_class;
        $this->data['filter_points'] = $filter_points;
        $this->data['filter_order'] = $filter_order;
        $this->data['filter_sku'] = $filter_sku;
        $this->data['filter_upc'] = $filter_upc;
        $this->data['filter_manufacturer'] = $filter_manufacturer;
        $this->data['filter_category_id'] = $filter_category_id;
        $this->data['filter_sub_category'] = $filter_sub_category;
        $this->data['filter_location'] = $filter_location;
        $this->data['filter_seo'] = $filter_seo;
        $this->data['filter_weight'] = $filter_weight;
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            if (isset($this->request->get['filter_name']) || isset($this->request->get['filter_model']) || isset($this->request->get['filter_category_id'])) {
            ]]></search>
            <add><![CDATA[
        if (isset($this->request->get['filter_name']) || isset($this->request->get['filter_model']) || isset($this->request->get['filter_category_id']) || isset($this->request->get['filter_seo']) || isset($this->request->get['filter_location']) || isset($this->request->get['filter_sku']) || isset($this->request->get['filter_upc'])) {
            ]]></add>
        </operation>
        <operation>
            <search position="before" index="2" offset="1"><![CDATA[
            $filter_name = $this->request->get['filter_name'];
            ]]></search>
            <add><![CDATA[
            if (isset($this->request->get['filter_upc'])) {
                $filter_upc = $this->request->get['filter_upc'];
            } else {
                $filter_upc = null;
            }

            if (isset($this->request->get['filter_sku'])) {
                $filter_sku = $this->request->get['filter_sku'];
            } else {
                $filter_sku = null;
            }

            if (isset($this->request->get['filter_location'])) {
                $filter_location = $this->request->get['filter_location'];
            } else {
                $filter_location = null;
            }

            if (isset($this->request->get['filter_seo'])) {
                $filter_seo = $this->request->get['filter_seo'];
            } else {
                $filter_seo = null;
            }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            'filter_name'         => $filter_name,
            ]]></search>
            <add><![CDATA[
                'filter_sku'          => $filter_sku,
                'filter_upc'          => $filter_upc,
                'filter_location'     => $filter_location,
                'filter_seo'          => $filter_seo,
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            'name'       => html_entity_decode($result['name'], ENT_QUOTES, 'UTF-8'),
            ]]></search>
            <add><![CDATA[
                    'seo'       => (isset($result['seo'])) ? $result['seo'] : '',
                    'sku'       => $result['sku'],
                    'upc'       => $result['upc'],
                    'location'  => $result['location'],
            ]]></add>
        </operation>
        <operation>
            <search position="before" offset="1"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
    public function load_name() {
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateLoadData($this->request->post)) {
            $this->load->model('localisation/language');
            $languages = $this->model_localisation_language->getLanguages();
            foreach($languages as $lang) {
                $json['languages'][$lang['language_id']] = $lang['name'];
            }
            $json['languages']['selected'] = $this->request->post['lang_id'];
            list($column, $id) = explode("-", $this->request->post['id']);
            
            $this->load->model('catalog/product');
            $result = $this->model_catalog_product->getProductDescriptions($id);
            $json['names'] = array();
            foreach($result as $lang => $desc) {
                $json['names'][$lang] = html_entity_decode($desc['name']);
            }
        } else {
            $this->language->load('catalog/product');
            $json['error'] = $this->language->get('error_load_name');
        }
        
        $this->response->setOutput(json_encode($json));
    }

    public function quick_update() {
        $this->language->load('catalog/product');
        $this->load->model('catalog/product');
        
        $json = array();
        
        if ($this->request->server['REQUEST_METHOD'] == 'POST' && $this->validateUpdateData($this->request->post)) {
            list($column, $id) = explode("-", $this->request->post['id']);
            $value = $this->request->post['new'];
            if ($column == "name") {
                $lang_id = $this->request->post['lang_id'];
            } else {
                $lang_id = null;
            }
            $result = $this->model_catalog_product->quickEditProduct($id, $column, $value, $lang_id);
            if ($result) {
                $json['success'] = $this->language->get('text_success');
                if (in_array($column, array('model', 'sku', 'upc', 'location', 'seo')))
                    $json['value'] = $value;
                else if (in_array($column, array('sort_order', 'points', 'minimum')))
                    $json['value'] = (int)$value;
                else if (in_array($column, array('subtract', 'shipping')))
                    $json['value'] = ((int)$value) ? $this->language->get('text_yes') : $this->language->get('text_no');
                else if ($column == 'status')
                    $json['value'] = ((int)$value) ? $this->language->get('text_enabled') : $this->language->get('text_disabled');
                else if ($column == 'tax_class') {
                    $this->load->model('localisation/tax_class');
                    $tax_class = $this->model_localisation_tax_class->getTaxClass((int)$value);
                    if ($tax_class)
                        $json['value'] = $tax_class['title'];
                    else
                        $json['value'] = '';
                } else if ($column == 'stock_status') {
                    $this->load->model('localisation/stock_status');
                    $stock_status = $this->model_localisation_stock_status->getStockStatus((int)$value);
                    if ($stock_status)
                        $json['value'] = $stock_status['name'];
                    else
                        $json['value'] = '';
                } else if ($column == 'length_class') {
                    $this->load->model('localisation/length_class');
                    $length_class = $this->model_localisation_length_class->getLengthClass((int)$value);
                    if ($length_class)
                        $json['value'] = $length_class['title'];
                    else
                        $json['value'] = '';
                } else if ($column == 'weight_class') {
                    $this->load->model('localisation/weight_class');
                    $weight_class = $this->model_localisation_weight_class->getWeightClass((int)$value);
                    if ($weight_class)
                        $json['value'] = $weight_class['title'];
                    else
                        $json['value'] = '';
                } else if ($column == 'manufacturer') {
                    $this->load->model('catalog/manufacturer');
                    $manufacturer = $this->model_catalog_manufacturer->getManufacturer((int)$value);
                    if ($manufacturer)
                        $json['value'] = $manufacturer['name'];
                    else
                        $json['value'] = '';
                } else if ($column == 'quantity') {
                    $value = (int)$value;
                    if ($value <= 0)
                        $ret = '<span style="color: #FF0000;">' . (int)$value . '</span>';
                    elseif ($value <= 5)
                        $ret = '<span style="color: #FFA500;">' . (int)$value . '</span>';
                    else
                        $ret = '<span style="color: #008000;">' . (int)$value . '</span>';
                    $json['value'] = $ret;
                } else if (in_array($column, array('weight', 'length', 'width', 'height')))
                    $json['value'] = sprintf("%.4f",round((float)$value, 4));
                else if($column == 'name') {
                    if ($lang_id == $this->config->get('config_language_id'))
                        $json['value'] = $value;
                    else
                        $json['value'] = $this->request->post['old'];
                } else if($column == 'price') {
                    $special = false;
                    
                    $product_specials = $this->model_catalog_product->getProductSpecials($id);

                    foreach ($product_specials  as $product_special) {
                        if (($product_special['date_start'] == '0000-00-00' || $product_special['date_start'] > date('Y-m-d')) && ($product_special['date_end'] == '0000-00-00' || $product_special['date_end'] < date('Y-m-d'))) {
                            $special = $product_special['price'];
                            break;
                        }
                    }
                    if ($special)
                        $ret = '<span style="text-decoration:line-through">' . sprintf("%.4f",round((float)$value, 4)) . '</span><br/><span style="color:#b00;">' . $special . '</span>';
                    else
                        $ret = sprintf("%.4f",round((float)$value, 4));
                    $json['value'] = $ret;
                } else
                    $json['value'] = $value;
            } else
                $json['error'] = $this->language->get('error_update');
        } else {
            $json['error'] = $this->error['warning'];
        }
        
        $this->response->setOutput(json_encode($json));
    }

    private function validateLoadData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/product')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column != "name") {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
    
    private function validateUpdateData($data) {
        if (!$this->user->hasPermission('modify', 'catalog/product')) {
            $this->error['warning'] = $this->language->get('error_permission');
        }

        if (!isset($data['id']) || strpos($data['id'], "-") === false) {
            $this->error['warning'] = $this->language->get('error_update');
            return false;
        }
        
        list($column, $id) = explode("-", $data['id']);
        
        if (!isset($data['old'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!isset($data['new'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if ($column == "model" && (strlen(utf8_decode($data['new'])) < 1) || (strlen(utf8_decode($data['new'])) > 64)) {
            $this->error['warning'] = $this->language->get('error_model');
        }

        if ($column == "name" && !isset($data['lang_id'])) {
            $this->error['warning'] = $this->language->get('error_update');
        }

        if (!$this->error) {
            return true;
        } else {
            return false;
        }
    }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/language/*/catalog/product.php">
        <operation error="log">
            <search position="before"><![CDATA[
            $_['text_success']
            ]]></search>
            <add><![CDATA[
$_['text_saving']            = 'Saving ...';
$_['text_loading']           = 'Loading ...';
$_['text_click_edit']        = 'Click to edit ...';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            $_['column_action']
            ]]></search>
            <add><![CDATA[
$_['column_tax_class']          = 'Tax Class';
$_['column_minimum']            = 'Min Qty';
$_['column_subtract']           = 'Subtract Stock';
$_['column_stock_status']       = 'Out Of Stock Status';
$_['column_shipping']           = 'Requires Shipping';
$_['column_date_available']     = 'Date Available';
$_['column_length']             = 'Length';
$_['column_width']              = 'Width';
$_['column_height']             = 'Height';
$_['column_length_class']       = 'Length Class';
$_['column_weight_class']       = 'Weight Class';
$_['column_points']             = 'Points';
$_['column_sort_order']         = 'Sort Order';
$_['column_sku']                = 'SKU';
$_['column_upc']                = 'UPC';
$_['column_manufacturer']       = 'Manufacturer';
$_['column_category']           = 'Category';
$_['column_location']           = 'Location';
$_['column_seo']                = 'SEO Keyword';
$_['column_weight']             = 'Weight';
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
$_['error_model']
            ]]></search>
            <add><![CDATA[
$_['error_update']           = 'Warning: Updating the value failed!';
$_['error_load_name']        = 'Warning: Loading name data failed!';
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/model/catalog/product.php">
        <operation>
            <search position="before"><![CDATA[
            public function addProduct($data)
            ]]></search>
            <add><![CDATA[
    public function quickEditProduct($product_id, $data, $value, $lang_id=null) {
        $editable = array('manufacturer', 'name', 'model', 'sku', 'upc', 'location', 'quantity', 'price', 'weight', 'status', 'sort_order', 'tax_class', 'minimum', 'subtract', 'stock_status', 'shipping', 'date_available', 'length', 'width', 'height', 'length_class', 'weight_class', 'points');
        $result = false;
        if (in_array($data, $editable)) {
            if (in_array($data, array('model', 'sku', 'upc', 'location', 'date_available')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "product SET " . $data . " = '" . $this->db->escape($value) . "', date_modified = NOW() WHERE product_id = '" . (int)$product_id . "'");
            else if (in_array($data, array('quantity', 'sort_order', 'status', 'minimum', 'subtract', 'shipping', 'points')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "product SET " . $data . " = '" . (int)$value . "', date_modified = NOW() WHERE product_id = '" . (int)$product_id . "'");
            else if (in_array($data, array('manufacturer', 'tax_class', 'stock_status', 'length_class', 'weight_class')))
                $result = $this->db->query("UPDATE " . DB_PREFIX . "product SET " . $data . "_id = '" . (int)$value . "', date_modified = NOW() WHERE product_id = '" . (int)$product_id . "'");
            else if ($data == "name")
                $result = $this->db->query("UPDATE " . DB_PREFIX . "product_description SET name = '" . $this->db->escape($value) . "' WHERE product_id = '" . (int)$product_id . "' AND language_id = '" . (int)$lang_id . "'");
            else
                $result = $this->db->query("UPDATE " . DB_PREFIX . "product SET " . $data . " = '" . (float)$value . "', date_modified = NOW() WHERE product_id = '" . (int)$product_id . "'");
        } else if ($data == 'seo') {
            $this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'product_id=" . (int)$product_id. "'");
            if (!empty($value))
                $result = $this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int)$product_id . "', keyword = '" . $this->db->escape($value) . "'");
            else
                $result = 1;
        }

        //$this->cache->delete('product');
        return $result;
    }
            ]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[
            $sql = "SELECT * FROM " . DB_PREFIX . "product p LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id)";
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            $cp_cols = @unserialize($this->config->get('aqe_catalog_products'));
            if (!is_array($cp_cols)) {
                $columns = array('image', 'name', 'model', 'price', 'quantity', 'status');
            } else {
                $columns = array();
                foreach($cp_cols as $column => $attr) {
                    if ($attr['display'])
                        $columns[] = $column;
                }
            }

            $sql = "SELECT p.*, pd.*";

            if (in_array("seo", $columns)) {
                $sql .= ", (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('product_id=', p.product_id)) AS seo";
            }

            if (in_array("manufacturer", $columns)) {
                $sql .= ", m.name AS manufacturer";
            }

            if (in_array("tax_class", $columns)) {
                $sql .= ", tc.title AS tax_class";
            }

            if (in_array("stock_status", $columns)) {
                $sql .= ", ss.name AS stock_status";
            }

            if (in_array("length_class", $columns)) {
                $sql .= ", lcd.title AS length_class";
            }

            if (in_array("weight_class", $columns)) {
                $sql .= ", wcd.title AS weight_class";
            }

            $sql .= " FROM " . DB_PREFIX . "product p LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id)";

            if (in_array("manufacturer", $columns)) {
                $sql .= " LEFT JOIN " . DB_PREFIX . "manufacturer m ON (m.manufacturer_id = p.manufacturer_id)";
            }

            if (in_array("tax_class", $columns)) {
                $sql .= " LEFT JOIN " . DB_PREFIX . "tax_class tc ON (tc.tax_class_id = p.tax_class_id)";
            }

            if (in_array("stock_status", $columns)) {
                $sql .= " LEFT JOIN " . DB_PREFIX . "stock_status ss ON (ss.stock_status_id = p.stock_status_id)";
            }

            if (in_array("length_class", $columns)) {
                $sql .= " LEFT JOIN " . DB_PREFIX . "length_class lc ON (lc.length_class_id = p.length_class_id) LEFT JOIN length_class_description lcd ON (lcd.length_class_id = lc.length_class_id)";
            }

            if (in_array("weight_class", $columns)) {
                $sql .= " LEFT JOIN " . DB_PREFIX . "weight_class wc ON (wc.weight_class_id = p.weight_class_id) LEFT JOIN weight_class_description wcd ON (wcd.weight_class_id = wc.weight_class_id)";
            }
        } else {
            $sql = "SELECT * FROM " . DB_PREFIX . "product p LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id)";
        }
            ]]></add>
        </operation>
        <operation>
            <search position="after" index="1"><![CDATA[
            $sql .= " WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "'";
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            if (in_array("length_class", $columns)) {
                $sql .= " AND lcd.language_id = '" . (int)$this->config->get('config_language_id') . "'";
            }

            if (in_array("weight_class", $columns)) {
                $sql .= " AND wcd.language_id = '" . (int)$this->config->get('config_language_id') . "'";
            }
        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (!empty($data['filter_name'])) {
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            if (isset($data['filter_tax_class']) && !is_null($data['filter_tax_class'])) {
                $sql .= " AND p.tax_class_id = '" . $this->db->escape($data['filter_tax_class']) . "'";
            }

            if (isset($data['filter_minimum']) && !is_null($data['filter_minimum'])) {
                $sql .= " AND p.minimum = '" . $this->db->escape($data['filter_minimum']) . "'";
            }

            if (isset($data['filter_subtract']) && !is_null($data['filter_subtract'])) {
                $sql .= " AND p.subtract = '" . $this->db->escape($data['filter_subtract']) . "'";
            }

            if (isset($data['filter_stock_status']) && !is_null($data['filter_stock_status'])) {
                $sql .= " AND p.stock_status_id = '" . $this->db->escape($data['filter_stock_status']) . "'";
            }

            if (isset($data['filter_shipping']) && !is_null($data['filter_shipping'])) {
                $sql .= " AND p.shipping = '" . $this->db->escape($data['filter_shipping']) . "'";
            }

            if (isset($data['filter_date_available']) && !is_null($data['filter_date_available'])) {
                $sql .= " AND p.date_available = '" . $this->db->escape($data['filter_date_available']) . "'";
            }

            if (isset($data['filter_length']) && !is_null($data['filter_length'])) {
                $sql .= " AND p.length = '" . $this->db->escape($data['filter_length']) . "'";
            }

            if (isset($data['filter_width']) && !is_null($data['filter_width'])) {
                $sql .= " AND p.width = '" . $this->db->escape($data['filter_width']) . "'";
            }

            if (isset($data['filter_height']) && !is_null($data['filter_height'])) {
                $sql .= " AND p.height = '" . $this->db->escape($data['filter_height']) . "'";
            }

            if (isset($data['filter_length_class']) && !is_null($data['filter_length_class'])) {
                $sql .= " AND p.length_class_id = '" . $this->db->escape($data['filter_length_class']) . "'";
            }

            if (isset($data['filter_weight_class']) && !is_null($data['filter_weight_class'])) {
                $sql .= " AND p.weight_class_id = '" . $this->db->escape($data['filter_weight_class']) . "'";
            }

            if (isset($data['filter_points']) && !is_null($data['filter_points'])) {
                $sql .= " AND p.points = '" . $this->db->escape($data['filter_points']) . "'";
            }

            if (isset($data['filter_order']) && !is_null($data['filter_order'])) {
                $sql .= " AND p.sort_order = '" . $this->db->escape($data['filter_order']) . "'";
            }

            if (!empty($data['filter_sku'])) {
                $sql .= " AND p.sku LIKE '" . $this->db->escape($data['filter_sku']) . "%'";
            }

            if (!empty($data['filter_upc'])) {
                $sql .= " AND p.upc LIKE '" . $this->db->escape($data['filter_upc']) . "%'";
            }

            if (isset($data['filter_manufacturer']) && !is_null($data['filter_manufacturer'])) {
                $sql .= " AND p.manufacturer_id = '" . $this->db->escape($data['filter_manufacturer']) . "'";
            }

            if (!empty($data['filter_location'])) {
                $sql .= " AND LCASE(p.location) LIKE '" . $this->db->escape(utf8_strtolower($data['filter_location'])) . "%'";
            }

            if (!empty($data['filter_seo'])) {
                $sql .= " AND (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = CONCAT('product_id=', p.product_id)) LIKE '%" . $this->db->escape($data['filter_seo']) . "%'";
            }

            if (isset($data['filter_weight']) && !is_null($data['filter_weight'])) {
                $sql .= " AND p.weight = '" . $this->db->escape($data['filter_weight']) . "'";
            }
        }
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            $implode_data[] = "category_id = '" . (int)$data['filter_category_id'] . "'";
            ]]></search>
            <add><![CDATA[
                    if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
                        if ($data['filter_category_id'] == '*')
                            $implode_data[] = "p2c.category_id IS NULL";
                        else
                            $implode_data[] = "p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
                    } else {
                        $implode_data[] = "p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
                    }
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            $sql .= " AND p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
            ]]></search>
            <add><![CDATA[
                    if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
                        if ($data['filter_category_id'] == '*')
                            $sql .= " AND p2c.category_id IS NULL";
                        else
                            $sql .= " AND p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
                    } else {
                        $sql .= " AND p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
                    }
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            $implode_data[] = "p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
            ]]></search>
            <add><![CDATA[
                    if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
                        if ($data['filter_category_id'] == '*')
                            $implode_data[] = "p2c.category_id IS NULL";
                        else
                            $implode_data[] = "p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
                    } else {
                        $implode_data[] = "p2c.category_id = '" . (int)$data['filter_category_id'] . "'";
                    }
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            $implode_data[] = "p2c.category_id = '" . (int)$category['category_id'] . "'";
            ]]></search>
            <add><![CDATA[
                        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
                            if ($data['filter_category_id'] != '*')
                                $implode_data[] = "p2c.category_id = '" . (int)$category['category_id'] . "'";
                        } else {
                            $implode_data[] = "p2c.category_id = '" . (int)$category['category_id'] . "'";
                        }
            ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
            ]]></search>
            <add><![CDATA[
        if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) {
            $sort_data[] = 'tc.title';
            $sort_data[] = 'p.minimum';
            $sort_data[] = 'p.subtract';
            $sort_data[] = 'ss.name';
            $sort_data[] = 'p.shipping';
            $sort_data[] = 'p.date_available';
            $sort_data[] = 'lc.title';
            $sort_data[] = 'wc.title';
            $sort_data[] = 'p.points';
            $sort_data[] = 'p.length';
            $sort_data[] = 'p.width';
            $sort_data[] = 'p.height';
            $sort_data[] = 'p.weight';
            $sort_data[] = 'p.sku';
            $sort_data[] = 'p.upc';
            $sort_data[] = 'p.location';
            $sort_data[] = 'm.name';
            $sort_data[] = 'seo';
        }
            ]]></add>
        </operation>
    </file>
    
    <file name="admin/view/template/catalog/product_list.tpl">
        <operation>
            <search position="replace" offset="25"><![CDATA[
            <td class="center"><?php echo $column_image; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td class="center"><?php echo $column_image; ?></td>
                        <?php break;
                    case 'name': ?>
              <td class="left"><?php if ($sort == 'pd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'model': ?>
              <td class="left"><?php if ($sort == 'p.model') { ?>
                <a href="<?php echo $sort_model; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_model; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_model; ?>"><?php echo $column_model; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'price': ?>
              <td class="left"><?php if ($sort == 'p.price') { ?>
                <a href="<?php echo $sort_price; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_price; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_price; ?>"><?php echo $column_price; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'quantity': ?>
              <td class="right"><?php if ($sort == 'p.quantity') { ?>
                <a href="<?php echo $sort_quantity; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_quantity; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_quantity; ?>"><?php echo $column_quantity; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left"><?php if ($sort == 'p.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right"><?php if ($sort == 'p.sort_order') { ?>
                <a href="<?php echo $sort_order; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sort_order; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_order; ?>"><?php echo $column_sort_order; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'sku': ?>
              <td class="left"><?php if ($sort == 'p.sku') { ?>
                <a href="<?php echo $sort_sku; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_sku; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_sku; ?>"><?php echo $column_sku; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'upc': ?>
              <td class="left"><?php if ($sort == 'p.upc') { ?>
                <a href="<?php echo $sort_upc; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_upc; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_upc; ?>"><?php echo $column_upc; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'manufacturer': ?>
              <td class="left"><?php if ($sort == 'm.name') { ?>
                <a href="<?php echo $sort_manufacturer; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_manufacturer; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_manufacturer; ?>"><?php echo $column_manufacturer; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'category': ?>
              <td class="left"><?php echo $column_category; ?></td>
                        <?php break;
                    case 'location': ?>
              <td class="left"><?php if ($sort == 'p.location') { ?>
                <a href="<?php echo $sort_location; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_location; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_location; ?>"><?php echo $column_location; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left"><?php if ($sort == 'seo') { ?>
                <a href="<?php echo $sort_seo; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_seo; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_seo; ?>"><?php echo $column_seo; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'weight': ?>
              <td class="left"><?php if ($sort == 'p.weight') { ?>
                <a href="<?php echo $sort_weight; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_weight; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_weight; ?>"><?php echo $column_weight; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'length': ?>
              <td class="left"><?php if ($sort == 'p.length') { ?>
                <a href="<?php echo $sort_length; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_length; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_length; ?>"><?php echo $column_length; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'width': ?>
              <td class="left"><?php if ($sort == 'p.width') { ?>
                <a href="<?php echo $sort_width; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_width; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_width; ?>"><?php echo $column_width; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'height': ?>
              <td class="left"><?php if ($sort == 'p.height') { ?>
                <a href="<?php echo $sort_height; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_height; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_height; ?>"><?php echo $column_height; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'length_class': ?>
              <td class="left"><?php if ($sort == 'lc.title') { ?>
                <a href="<?php echo $sort_length_class; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_length_class; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_length_class; ?>"><?php echo $column_length_class; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'weight_class': ?>
              <td class="left"><?php if ($sort == 'wc.title') { ?>
                <a href="<?php echo $sort_weight_class; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_weight_class; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_weight_class; ?>"><?php echo $column_weight_class; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'points': ?>
              <td class="left"><?php if ($sort == 'p.points') { ?>
                <a href="<?php echo $sort_points; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_points; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_points; ?>"><?php echo $column_points; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'date_available': ?>
              <td class="left"><?php if ($sort == 'p.date_available') { ?>
                <a href="<?php echo $sort_date_available; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_date_available; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_date_available; ?>"><?php echo $column_date_available; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'requires_shipping': ?>
              <td class="left"><?php if ($sort == 'p.shipping') { ?>
                <a href="<?php echo $sort_shipping; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_shipping; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_shipping; ?>"><?php echo $column_shipping; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'stock_status': ?>
              <td class="left"><?php if ($sort == 'ss.name') { ?>
                <a href="<?php echo $sort_stock_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_stock_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_stock_status; ?>"><?php echo $column_stock_status; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'subtract': ?>
              <td class="left"><?php if ($sort == 'p.subtract') { ?>
                <a href="<?php echo $sort_subtract; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_subtract; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_subtract; ?>"><?php echo $column_subtract; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'minimum': ?>
              <td class="left"><?php if ($sort == 'p.minimum') { ?>
                <a href="<?php echo $sort_minimum; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_minimum; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_minimum; ?>"><?php echo $column_minimum; ?></a>
                <?php } ?></td>
                        <?php break;
                    case 'tax_class': ?>
              <td class="left"><?php if ($sort == 'tc.title') { ?>
                <a href="<?php echo $sort_tax_class; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_tax_class; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_tax_class; ?>"><?php echo $column_tax_class; ?></a>
                <?php } ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="center"><?php echo $column_image; ?></td>
              <td class="left"><?php if ($sort == 'pd.name') { ?>
                <a href="<?php echo $sort_name; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_name; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_name; ?>"><?php echo $column_name; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'p.model') { ?>
                <a href="<?php echo $sort_model; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_model; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_model; ?>"><?php echo $column_model; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'p.price') { ?>
                <a href="<?php echo $sort_price; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_price; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_price; ?>"><?php echo $column_price; ?></a>
                <?php } ?></td>
              <td class="right"><?php if ($sort == 'p.quantity') { ?>
                <a href="<?php echo $sort_quantity; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_quantity; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_quantity; ?>"><?php echo $column_quantity; ?></a>
                <?php } ?></td>
              <td class="left"><?php if ($sort == 'p.status') { ?>
                <a href="<?php echo $sort_status; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_status; ?></a>
                <?php } else { ?>
                <a href="<?php echo $sort_status; ?>"><?php echo $column_status; ?></a>
                <?php } ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="19"><![CDATA[
            <tr class="filter">
            ]]></search>
            <add><![CDATA[
            <tr class="filter">
              <td></td>
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td></td>
                        <?php break;
                    case 'name': ?>
              <td><input type="text" name="filter_name" value="<?php echo $filter_name; ?>" /></td>
                        <?php break;
                    case 'model': ?>
              <td><input type="text" name="filter_model" value="<?php echo $filter_model; ?>" /></td>
                        <?php break;
                    case 'price': ?>
              <td align="left"><input type="text" name="filter_price" value="<?php echo $filter_price; ?>" size="8"/></td>
                        <?php break;
                    case 'quantity': ?>
              <td align="right"><input type="text" name="filter_quantity" value="<?php echo $filter_quantity; ?>" size="6" style="text-align: right;" /></td>
                        <?php break;
                    case 'status': ?>
              <td><select name="filter_status">
                  <option value="*"></option>
                  <?php if ($filter_status) { ?>
                  <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_enabled; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_status) && !$filter_status) { ?>
                  <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_disabled; ?></option>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'sort_order': ?>
              <td align="right"><input type="text" name="filter_order" value="<?php echo $filter_order; ?>" size="4" style="text-align: right;" /></td>
                        <?php break;
                    case 'sku': ?>
              <td align="left"><input type="text" name="filter_sku" value="<?php echo $filter_sku; ?>" size="8" /></td>
                        <?php break;
                    case 'upc': ?>
              <td align="left"><input type="text" name="filter_upc" value="<?php echo $filter_upc; ?>" size="8" /></td>
                        <?php break;
                    case 'manufacturer': ?>
              <td><select name="filter_manufacturer">
                  <option value=""></option>
                  <option value="*"<?php echo (!is_null($filter_manufacturer) && $filter_manufacturer == '*') ? ' selected="selected"' : ''; ?>><?php echo $text_none; ?></option>
              <?php foreach($manufacturers as $m) {?>
                  <?php if (!is_null($filter_manufacturer) && $filter_manufacturer == $m['manufacturer_id']) { ?>
                  <option value="<?php echo $m['manufacturer_id']; ?>" selected="selected"><?php echo $m['name']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $m['manufacturer_id']; ?>"><?php echo $m['name']; ?></option>
                  <?php } ?>
              <?php } ?>
                </select></td>
                        <?php break;
                    case 'category': ?>
              <td><select name="filter_category">
                  <option value=""></option>
                  <option value="*"<?php echo (!is_null($filter_category_id) && $filter_category_id == '*') ? ' selected="selected"' : ''; ?>><?php echo $text_none; ?></option>
              <?php foreach($categories as $c) {?>
                  <?php if (!is_null($filter_category_id) && $filter_category_id == $c['category_id']) { ?>
                  <option value="<?php echo $c['category_id']; ?>" selected="selected"><?php echo $c['name']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $c['category_id']; ?>"><?php echo $c['name']; ?></option>
                  <?php } ?>
              <?php } ?>
                </select></td>
                        <?php break;
                    case 'location': ?>
              <td align="left"><input type="text" name="filter_location" value="<?php echo $filter_location; ?>" size="12" /></td>
                        <?php break;
                    case 'seo': ?>
              <td align="left"><input type="text" name="filter_seo" value="<?php echo $filter_seo; ?>" /></td>
                        <?php break;
                    case 'weight': ?>
              <td align="left"><input type="text" name="filter_weight" value="<?php echo $filter_weight; ?>" size="6" /></td>
                        <?php break;
                    case 'length': ?>
              <td align="left"><input type="text" name="filter_length" value="<?php echo $filter_length; ?>" size="6" /></td>
                        <?php break;
                    case 'width': ?>
              <td align="left"><input type="text" name="filter_width" value="<?php echo $filter_width; ?>" size="6" /></td>
                        <?php break;
                    case 'height': ?>
              <td align="left"><input type="text" name="filter_height" value="<?php echo $filter_height; ?>" size="6" /></td>
                        <?php break;
                    case 'length_class': ?>
              <td><select name="filter_length_class">
                  <option value=""></option>
              <?php foreach($length_classes as $lc) {?>
                  <?php if (!is_null($filter_length_class) && $filter_length_class == $lc['length_class_id']) { ?>
                  <option value="<?php echo $lc['length_class_id']; ?>" selected="selected"><?php echo $lc['title']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $lc['length_class_id']; ?>"><?php echo $lc['title']; ?></option>
                  <?php } ?>
              <?php } ?>
                </select></td>
                        <?php break;
                    case 'weight_class': ?>
              <td><select name="filter_weight_class">
                  <option value=""></option>
              <?php foreach($weight_classes as $wc) {?>
                  <?php if (!is_null($filter_weight_class) && $filter_weight_class == $wc['weight_class_id']) { ?>
                  <option value="<?php echo $wc['weight_class_id']; ?>" selected="selected"><?php echo $wc['title']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $wc['weight_class_id']; ?>"><?php echo $wc['title']; ?></option>
                  <?php } ?>
              <?php } ?>
                </select></td>
                        <?php break;
                    case 'points': ?>
              <td align="left"><input type="text" name="filter_points" value="<?php echo $filter_points; ?>" size="6" /></td>
                        <?php break;
                    case 'date_available': ?>
              <td align="left"><input type="text" name="filter_date_available" value="<?php echo $filter_date_available; ?>" id="date_available" size="12" /></td>
                        <?php break;
                    case 'requires_shipping': ?>
              <td><select name="filter_shipping">
                  <option value="*"></option>
                  <?php if ($filter_shipping) { ?>
                  <option value="1" selected="selected"><?php echo $text_yes; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_yes; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_shipping) && !$filter_shipping) { ?>
                  <option value="0" selected="selected"><?php echo $text_no; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_no; ?></option>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'stock_status': ?>
              <td><select name="filter_stock_status">
                  <option value=""></option>
              <?php foreach($stock_statuses as $ss) {?>
                  <?php if (!is_null($filter_stock_status) && $filter_stock_status == $ss['stock_status_id']) { ?>
                  <option value="<?php echo $ss['stock_status_id']; ?>" selected="selected"><?php echo $ss['name']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $ss['stock_status_id']; ?>"><?php echo $ss['name']; ?></option>
                  <?php } ?>
              <?php } ?>
                </select></td>
                        <?php break;
                    case 'subtract': ?>
              <td><select name="filter_subtract">
                  <option value="*"></option>
                  <?php if ($filter_subtract) { ?>
                  <option value="1" selected="selected"><?php echo $text_yes; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_yes; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_subtract) && !$filter_subtract) { ?>
                  <option value="0" selected="selected"><?php echo $text_no; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_no; ?></option>
                  <?php } ?>
                </select></td>
                        <?php break;
                    case 'minimum': ?>
              <td align="left"><input type="text" name="filter_minimum" value="<?php echo $filter_minimum; ?>" size="6" /></td>
                        <?php break;
                    case 'tax_class': ?>
              <td><select name="filter_tax_class">
                  <option value=""></option>
                  <option value="*"<?php echo (!is_null($filter_tax_class) && $filter_tax_class == '*') ? ' selected="selected"' : ''; ?>><?php echo $text_none; ?></option>
              <?php foreach($tax_classes as $tc) {?>
                  <?php if (!is_null($filter_tax_class) && $filter_tax_class == $tc['tax_class_id']) { ?>
                  <option value="<?php echo $tc['tax_class_id']; ?>" selected="selected"><?php echo $tc['title']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $tc['tax_class_id']; ?>"><?php echo $tc['title']; ?></option>
                  <?php } ?>
              <?php } ?>
                </select></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td></td>
              <td><input type="text" name="filter_name" value="<?php echo $filter_name; ?>" /></td>
              <td><input type="text" name="filter_model" value="<?php echo $filter_model; ?>" /></td>
              <td align="left"><input type="text" name="filter_price" value="<?php echo $filter_price; ?>" size="8"/></td>
              <td align="right"><input type="text" name="filter_quantity" value="<?php echo $filter_quantity; ?>" style="text-align: right;" /></td>
              <td><select name="filter_status">
                  <option value="*"></option>
                  <?php if ($filter_status) { ?>
                  <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_enabled; ?></option>
                  <?php } ?>
                  <?php if (!is_null($filter_status) && !$filter_status) { ?>
                  <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_disabled; ?></option>
                  <?php } ?>
                </select></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="replace" offset="23"><![CDATA[
            <?php foreach ($products as $product) { ?>
            ]]></search>
            <add><![CDATA[
            <?php foreach ($products as $product) { ?>
            <tr>
              <td style="text-align: center;"><?php if ($product['selected']) { ?>
                <input type="checkbox" name="selected[]" value="<?php echo $product['product_id']; ?>" checked="checked" />
                <?php } else { ?>
                <input type="checkbox" name="selected[]" value="<?php echo $product['product_id']; ?>" />
                <?php } ?></td>
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) { ?>
              <?php foreach($column_order as $col) {
                switch ($col) {
                    case 'image': ?>
              <td class="center"><img src="<?php echo $product['image']; ?>" alt="<?php echo $product['name']; ?>" style="padding: 1px; border: 1px solid #DDDDDD;" /></td>
                        <?php break;
                    case 'name': ?>
              <td class="left name<?php echo ($column_info[$col]['qe_status']) ? ' name_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['name']; ?></td>
                        <?php break;
                    case 'model': ?>
              <td class="left model<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['model']; ?></td>
                        <?php break;
                    case 'price': ?>
              <td class="left price<?php echo ($column_info[$col]['qe_status']) ? ' price_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>">
                <?php if ($product['special']) { ?>
                <span style="text-decoration: line-through;"><?php echo $product['price']; ?></span><br/>
                <span style="color: #b00;"><?php echo $product['special']; ?></span>
                <?php } else { ?>
                <?php echo $product['price']; ?>
                <?php } ?>
              </td>
                        <?php break;
                    case 'quantity': ?>
              <td class="right quantity<?php echo ($column_info[$col]['qe_status']) ? ' qty_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php if ($product['quantity'] <= 0) { ?>
                <span style="color: #FF0000;"><?php echo $product['quantity']; ?></span>
                <?php } elseif ($product['quantity'] <= 5) { ?>
                <span style="color: #FFA500;"><?php echo $product['quantity']; ?></span>
                <?php } else { ?>
                <span style="color: #008000;"><?php echo $product['quantity']; ?></span>
                <?php } ?></td>
                        <?php break;
                    case 'status': ?>
              <td class="left status<?php echo ($column_info[$col]['qe_status']) ? ' status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['status']; ?></td>
                        <?php break;
                    case 'sort_order': ?>
              <td class="right sort_order<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['sort_order']; ?></td>
                        <?php break;
                    case 'sku': ?>
              <td class="left sku<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['sku']; ?></td>
                        <?php break;
                    case 'upc': ?>
              <td class="left upc<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['upc']; ?></td>
                        <?php break;
                    case 'manufacturer': ?>
              <td class="left manufacturer<?php echo ($column_info[$col]['qe_status']) ? ' manufacturer_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['manufacturer']; ?></td>
                        <?php break;
                    case 'category': ?>
              <td class="left category" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['category']; ?></td>
                        <?php break;
                    case 'location': ?>
              <td class="left location<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['location']; ?></td>
                        <?php break;
                    case 'seo': ?>
              <td class="left seo<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['seo']; ?></td>
                        <?php break;
                    case 'weight': ?>
              <td class="left weight<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['weight']; ?></td>
                        <?php break;
                    case 'length': ?>
              <td class="left length<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['length']; ?></td>
                        <?php break;
                    case 'width': ?>
              <td class="left width<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['width']; ?></td>
                        <?php break;
                    case 'height': ?>
              <td class="left height<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['height']; ?></td>
                        <?php break;
                    case 'length_class': ?>
              <td class="left length_class<?php echo ($column_info[$col]['qe_status']) ? ' length_class_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['length_class']; ?></td>
                        <?php break;
                    case 'weight_class': ?>
              <td class="left weight_class<?php echo ($column_info[$col]['qe_status']) ? ' weight_class_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['weight_class']; ?></td>
                        <?php break;
                    case 'points': ?>
              <td class="left points<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['points']; ?></td>
                        <?php break;
                    case 'date_available': ?>
              <td class="left date_available<?php echo ($column_info[$col]['qe_status']) ? ' date_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['date_available']; ?></td>
                        <?php break;
                    case 'requires_shipping': ?>
              <td class="left shipping<?php echo ($column_info[$col]['qe_status']) ? ' yes_no_quick_edit' : ''; ?>" id="<?php echo "shipping-" . $product['product_id']; ?>"><?php echo $product['shipping']; ?></td>
                        <?php break;
                    case 'stock_status': ?>
              <td class="left stock_status<?php echo ($column_info[$col]['qe_status']) ? ' stock_status_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['stock_status']; ?></td>
                        <?php break;
                    case 'subtract': ?>
              <td class="left subtract<?php echo ($column_info[$col]['qe_status']) ? ' yes_no_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['subtract']; ?></td>
                        <?php break;
                    case 'minimum': ?>
              <td class="left minimum<?php echo ($column_info[$col]['qe_status']) ? ' quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['minimum']; ?></td>
                        <?php break;
                    case 'tax_class': ?>
              <td class="left tax_class<?php echo ($column_info[$col]['qe_status']) ? ' tax_class_quick_edit' : ''; ?>" id="<?php echo $col . "-" . $product['product_id']; ?>"><?php echo $product['tax_class']; ?></td>
                        <?php break;
                }
              } ?>
            <?php } else { ?>
              <td class="center"><img src="<?php echo $product['image']; ?>" alt="<?php echo $product['name']; ?>" style="padding: 1px; border: 1px solid #DDDDDD;" /></td>
              <td class="left"><?php echo $product['name']; ?></td>
              <td class="left"><?php echo $product['model']; ?></td>
              <td class="left"><?php if ($product['special']) { ?>
                <span style="text-decoration: line-through;"><?php echo $product['price']; ?></span><br/>
                <span style="color: #b00;"><?php echo $product['special']; ?></span>
                <?php } else { ?>
                <?php echo $product['price']; ?>
                <?php } ?></td>
              <td class="right"><?php if ($product['quantity'] <= 0) { ?>
                <span style="color: #FF0000;"><?php echo $product['quantity']; ?></span>
                <?php } elseif ($product['quantity'] <= 5) { ?>
                <span style="color: #FFA500;"><?php echo $product['quantity']; ?></span>
                <?php } else { ?>
                <span style="color: #008000;"><?php echo $product['quantity']; ?></span>
                <?php } ?></td>
              <td class="left"><?php echo $product['status']; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[
            <td class="center" colspan="8"><?php echo $text_no_results; ?></td>
            ]]></search>
            <add><![CDATA[
            <?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) { ?>
              <td class="center" colspan="<?php echo count($column_order) + 2; ?>"><?php echo $text_no_results; ?></td>
            <?php } else { ?>
              <td class="center" colspan="8"><?php echo $text_no_results; ?></td>
            <?php } ?>
            ]]></add>
        </operation>
        <operation error="log">
            <search position="before"><![CDATA[
            var filter_name = $('input[name=\'filter_name\']').attr('value');
            ]]></search>
            <add><![CDATA[
    var filter_tax_class = $('select[name=\'filter_tax_class\']').attr('value');

    if (filter_tax_class) {
        url += '&filter_tax_class=' + encodeURIComponent(filter_tax_class);
    }

    var filter_minimum = $('input[name=\'filter_minimum\']').attr('value');

    if (filter_minimum) {
        url += '&filter_minimum=' + encodeURIComponent(filter_minimum);
    }

    var filter_subtract = $('select[name=\'filter_subtract\']').attr('value');

    if (filter_subtract && filter_subtract != '*') {
        url += '&filter_subtract=' + encodeURIComponent(filter_subtract);
    }

    var filter_stock_status = $('select[name=\'filter_stock_status\']').attr('value');

    if (filter_stock_status) {
        url += '&filter_stock_status=' + encodeURIComponent(filter_stock_status);
    }

    var filter_shipping = $('select[name=\'filter_shipping\']').attr('value');

    if (filter_shipping && filter_shipping != '*') {
        url += '&filter_shipping=' + encodeURIComponent(filter_shipping);
    }

    var filter_date_available = $('input[name=\'filter_date_available\']').attr('value');

    if (filter_date_available) {
        url += '&filter_date_available=' + encodeURIComponent(filter_date_available);
    }

    var filter_length = $('input[name=\'filter_length\']').attr('value');

    if (filter_length) {
        url += '&filter_length=' + encodeURIComponent(filter_length);
    }

    var filter_width = $('input[name=\'filter_width\']').attr('value');

    if (filter_width) {
        url += '&filter_width=' + encodeURIComponent(filter_width);
    }

    var filter_height = $('input[name=\'filter_height\']').attr('value');

    if (filter_height) {
        url += '&filter_height=' + encodeURIComponent(filter_height);
    }

    var filter_length_class = $('select[name=\'filter_length_class\']').attr('value');

    if (filter_length_class) {
        url += '&filter_length_class=' + encodeURIComponent(filter_length_class);
    }

    var filter_weight_class = $('select[name=\'filter_weight_class\']').attr('value');

    if (filter_weight_class) {
        url += '&filter_weight_class=' + encodeURIComponent(filter_weight_class);
    }

    var filter_points = $('input[name=\'filter_points\']').attr('value');

    if (filter_points) {
        url += '&filter_points=' + encodeURIComponent(filter_points);
    }

    var filter_order = $('input[name=\'filter_order\']').attr('value');

    if (filter_order) {
        url += '&filter_order=' + encodeURIComponent(filter_order);
    }

    var filter_sku = $('input[name=\'filter_sku\']').attr('value');

    if (filter_sku) {
        url += '&filter_sku=' + encodeURIComponent(filter_sku);
    }

    var filter_upc = $('input[name=\'filter_upc\']').attr('value');

    if (filter_upc) {
        url += '&filter_upc=' + encodeURIComponent(filter_upc);
    }

    var filter_manufacturer = $('select[name=\'filter_manufacturer\']').attr('value');

    if (filter_manufacturer) {
        url += '&filter_manufacturer=' + encodeURIComponent(filter_manufacturer);
    }

    var filter_category = $('select[name=\'filter_category\']').attr('value');

    if (filter_category) {
        url += '&filter_category_id=' + encodeURIComponent(filter_category) + '&filter_sub_category=<?php echo (isset($filter_sub_category)) ? $filter_sub_category : '0'; ?>';
    }

    var filter_location = $('input[name=\'filter_location\']').attr('value');

    if (filter_location) {
        url += '&filter_location=' + encodeURIComponent(filter_location);
    }

    var filter_seo = $('input[name=\'filter_seo\']').attr('value');

    if (filter_seo) {
        url += '&filter_seo=' + encodeURIComponent(filter_seo);
    }

    var filter_weight = $('input[name=\'filter_weight\']').attr('value');

    if (filter_weight) {
        url += '&filter_weight=' + encodeURIComponent(filter_weight);
    }
            ]]></add>
        </operation>
        <operation error="log">
            <search position="replace"><![CDATA[filter_status != '*']]></search>
            <add><![CDATA[filter_status && filter_status != '*']]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[
            <?php echo $footer; ?>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status') && $this->config->get('aqe_catalog_products_status')) { ?>
<script type="text/javascript" src="view/javascript/admin.quick.edit.pro.js"></script>
<script type="text/javascript"><!--
$(function() {
  $('#date_available').datepicker({dateFormat: 'yy-mm-dd'});

  $(".quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

  $(".date_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, { 
      type      : "date_edit",
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });

  $(".status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
  });
  $(".qty_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : function(value, settings) {
          return $.trim(value.replace(/<.*?>/g, ''));
      },
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
  $(".price_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : function(value, settings) {
          var test = $("<div/>").html(value);
          if (test.children("span").length) {
              return test.children("span").first().text();
          } else
            return $.trim(value);
      },
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      select    : true,
  });
<?php if ($single_lang_editing) { ?>
  $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: <?php echo $language_id; ?>};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
  });
<?php } else { ?>
  $(".name_quick_edit").editable(function(value, settings) {
    var params = {lang_id: $('select', this).find(":selected").val()};
    return quick_update(this, value, settings, '<?php echo $update_url; ?>', params);
  }, {
      type      : 'name_edit',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      onblur    : "cancel",
      placeholder : "",
      loadurl   : "<?php echo $load_name_url; ?>",
      loadtype  : "POST",
      loadtext  : "<?php echo $text_loading; ?>",
      loaddata  : {lang_id: <?php echo $language_id; ?>}
  });
<?php } ?>
  $(".manufacturer_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($manufacturer_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
  $(".length_class_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($length_class_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
  $(".weight_class_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($weight_class_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
  $(".yes_no_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($yes_no_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
  $(".stock_status_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($stock_status_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
  $(".tax_class_quick_edit").editable(function(value, settings) {
    return quick_update(this, value, settings, '<?php echo $update_url; ?>');
  }, {
      data      : '<?php echo trim($tax_class_select); ?>',
      type      : 'select',
      indicator : "<?php echo $text_saving; ?>",
      tooltip   : "<?php echo $text_click_edit; ?>",
      placeholder : "",
      onblur    : "cancel",
  });
});
$('input[name=\'filter_seo\']').autocomplete({
    delay: 0,
    source: function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/product/autocomplete&token=<?php echo $token; ?>&filter_seo=' + encodeURIComponent(request.term),
            dataType: 'json',
            success: function(json) {
                response($.map(json, function(item) {
                    return {
                        label: item.seo,
                        value: item.product_id
                    }
                }));
            }
        });
    }, 
    select: function(event, ui) {
        $('input[name=\'filter_seo\']').val(ui.item.label);
        return false;
    }
});
$('input[name=\'filter_sku\']').autocomplete({
    delay: 0,
    source: function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/product/autocomplete&token=<?php echo $token; ?>&filter_sku=' + encodeURIComponent(request.term),
            dataType: 'json',
            success: function(json) {
                response($.map(json, function(item) {
                    return {
                        label: item.sku,
                        value: item.product_id
                    }
                }));
            }
        });
    }, 
    select: function(event, ui) {
        $('input[name=\'filter_sku\']').val(ui.item.label);
        return false;
    }
});
$('input[name=\'filter_upc\']').autocomplete({
    delay: 0,
    source: function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/product/autocomplete&token=<?php echo $token; ?>&filter_upc=' + encodeURIComponent(request.term),
            dataType: 'json',
            success: function(json) {
                response($.map(json, function(item) {
                    return {
                        label: item.upc,
                        value: item.product_id
                    }
                }));
            }
        });
    }, 
    select: function(event, ui) {
        $('input[name=\'filter_upc\']').val(ui.item.label);
        return false;
    }
});
$('input[name=\'filter_location\']').autocomplete({
    delay: 0,
    source: function(request, response) {
        $.ajax({
            url: 'index.php?route=catalog/product/autocomplete&token=<?php echo $token; ?>&filter_location=' + encodeURIComponent(request.term),
            dataType: 'json',
            success: function(json) {
                response($.unique($.map(json, function(item) {
                    return item.location
                })));
            }
        });
    }, 
    select: function(event, ui) {
        $('input[name=\'filter_location\']').val(ui.item.label);
        return false;
    }
});
//--></script>
<?php } ?>
            ]]></add>
        </operation>
    </file>


    <file name="admin/view/template/common/header.tpl">
        <operation>
            <search position="after"><![CDATA[
            <link rel="stylesheet" type="text/css" href="view/stylesheet/stylesheet.css" />
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status')) { ?>
<link rel="stylesheet" type="text/css" href="view/stylesheet/aqe_style.css" />
<?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[
            <script type="text/javascript" src="view/javascript/jquery/tabs.js"></script>
            ]]></search>
            <add><![CDATA[
<?php if ($this->config->get('admin_quick_edit_status')) { ?>
<script type="text/javascript" src="view/javascript/jquery/jquery.jeditable.js"></script>
<?php } ?>
            ]]></add>
        </operation>
    </file>

</modification>

<!--
<modification>  - This is the highest level of the file and there can only be one
<id>            - This is the name of the mod. Format: Free form text. (Informational)
<version>       - This is the version of the mod. Format: Number and Decimal (1.0.0) (Informational)
<author>        - This is the author of the mod. Format: Free form text (Informational)
<file>          - This is the name of the file to modify. Requires attribute "name" as relative filename (catalog/controller/product/product.php). There can be multiple
<operation>     - This is the wrapper of the actual operation occuring. There can be multiple operations to the same file.
<search>        - This is the first required step of the operation. Uses an optional attribute "position" set to before|after|replace. replace is default. One per operation. Use CDATA tags to wrap code.
<add>           - This is the second required step of the operation. Uses an optional attribute "trim" set to true|false to trim away whitespace and linebreaks. false is default. One per operation. Location of added data depends on the position of the <search> command. Use CDATA tags to wrap code.
<![CDATA[  ]]>  - These are called CDATA tags and they are used by xml to specify that the data between should not be evaluated.
-->